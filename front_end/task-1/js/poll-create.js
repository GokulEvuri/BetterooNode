/*
 * JavaScript Canvas to Blob 2.0.5
 * https://github.com/blueimp/JavaScript-Canvas-to-Blob
 *
 * Copyright 2012, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 *
 * Based on stackoverflow user Stoive's code snippet:
 * http://stackoverflow.com/q/4998908
 */
!function(window){"use strict";var CanvasPrototype=window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype,hasBlobConstructor=window.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),hasArrayBufferViewSupport=hasBlobConstructor&&window.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,dataURLtoBlob=(hasBlobConstructor||BlobBuilder)&&window.atob&&window.ArrayBuffer&&window.Uint8Array&&function(dataURI){var byteString,arrayBuffer,intArray,i,mimeString,bb;for(byteString=dataURI.split(",")[0].indexOf("base64")>=0?atob(dataURI.split(",")[1]):decodeURIComponent(dataURI.split(",")[1]),arrayBuffer=new ArrayBuffer(byteString.length),intArray=new Uint8Array(arrayBuffer),i=0;i<byteString.length;i+=1)intArray[i]=byteString.charCodeAt(i);return mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0],hasBlobConstructor?new Blob([hasArrayBufferViewSupport?intArray:arrayBuffer],{type:mimeString}):(bb=new BlobBuilder,bb.append(arrayBuffer),bb.getBlob(mimeString))};window.HTMLCanvasElement&&!CanvasPrototype.toBlob&&(CanvasPrototype.mozGetAsFile?CanvasPrototype.toBlob=function(callback,type,quality){quality&&CanvasPrototype.toDataURL&&dataURLtoBlob?callback(dataURLtoBlob(this.toDataURL(type,quality))):callback(this.mozGetAsFile("blob",type))}:CanvasPrototype.toDataURL&&dataURLtoBlob&&(CanvasPrototype.toBlob=function(callback,type,quality){callback(dataURLtoBlob(this.toDataURL(type,quality)))})),"function"==typeof define&&define.amd?define(function(){return dataURLtoBlob}):window.dataURLtoBlob=dataURLtoBlob}(this),function(){window.ImageZoom=function(image,options){function bgSize(){return{width:bgWidth,height:bgHeight,offsetX:bgPosX,offsetY:bgPosY}}function loaded(){width=$img.width(),height=$img.height(),naturalHeight=img.naturalHeight,naturalWidth=img.naturalWidth,currentWidth=width,currentHeight=height,$img.css({background:"url('"+origSrc+"') 0 0 no-repeat"}).bind("wheelzoom.reset",reset),img.src=transparentPNG,img.width=width,img.height=height,reset(),$img.data({scale:1,offsetX:0,offsetY:0,width:img.width,height:img.height});var wheel=wheelType();wheel&&(img[wheel]=wheelUpdate),initMobileDragAndPinch(),initKeyboardBindings()}function reset(){naturalWidth>naturalHeight?(bgWidth=currentHeight/naturalHeight*naturalWidth,bgHeight=currentHeight):(bgHeight=currentWidth/naturalWidth*naturalHeight,bgWidth=currentWidth),currentWidth>bgWidth&&(bgHeight=currentWidth/bgWidth*bgHeight,bgWidth=currentWidth),currentHeight>bgHeight&&(bgWidth=currentHeight/bgHeight*bgWidth,bgHeight=currentHeight),bgPosX=(currentWidth-bgWidth)/2,bgPosY=(currentHeight-bgHeight)/2,updateBgStyle()}function updateBgStyle(){var w=parseInt(bgWidth),h=parseInt(bgHeight),x=parseInt(bgPosX),y=parseInt(bgPosY);img.style.backgroundSize=w+"px "+h+"px",img.style.backgroundPosition=x+"px "+y+"px",console.log("image: "+currentWidth+"x"+currentHeight+"; bg: "+w+"x"+h+"; offset x: "+x+" y: "+y)}function resize(newWidth,newHeight){var newAspectRatio=parseInt(100*newWidth/newHeight),origAspectRatio=parseInt(100*currentWidth/currentHeight),aspectRatioChanged=Math.abs(1-newAspectRatio/origAspectRatio)>.1;if(aspectRatioChanged){var deltaX=newWidth-currentWidth;bgPosX+=deltaX/2;var deltaY=newHeight-currentHeight;bgPosY+=deltaY/2}else{var pctX=newWidth/currentWidth;bgWidth*=pctX,bgPosX*=pctX;var pctY=newHeight/currentHeight;bgHeight*=pctY,bgPosY*=pctY}currentWidth=newWidth,currentHeight=newHeight,updateBgStyle()}function wheelType(){var wheel;return void 0!==document.onmousewheel?wheel="onmousewheel":void 0!==document.onwheel&&(wheel="onwheel"),wheel}function wheelUpdate(e){var deltaY=0;e.preventDefault(),e.deltaY?deltaY=e.deltaY:e.wheelDelta&&(deltaY=-e.wheelDelta);var offsetParent=$img.offset(),offsetX=e.pageX-offsetParent.left,offsetY=e.pageY-offsetParent.top,bgCursorX=offsetX-bgPosX,bgCursorY=offsetY-bgPosY,bgRatioX=bgCursorX/bgWidth,bgRatioY=bgCursorY/bgHeight,bgWidthNew=bgWidth,bgHeightNew=bgHeight,bgPosXNew=bgPosX,bgPosYNew=bgPosY;if(0>deltaY?(bgWidthNew+=bgWidthNew*settings.zoom,bgHeightNew+=bgHeightNew*settings.zoom):(bgWidthNew-=bgWidthNew*settings.zoom,bgHeightNew-=bgHeightNew*settings.zoom),bgPosXNew=offsetX-bgWidthNew*bgRatioX,bgPosYNew=offsetY-bgHeightNew*bgRatioY,deltaY>0){var currentReduction=Math.max(bgWidthNew/currentWidth,bgHeightNew/currentHeight);if(currentReduction<=settings.maxZoomContainerPct)return}bgWidth=bgWidthNew,bgHeight=bgHeightNew,bgPosX=bgPosXNew,bgPosY=bgPosYNew,updateBgStyle()}function initMobileDragAndPinch(){var lastDragDeltaX=0,lastDragDeltaY=0;Hammer(img,{drag_block_horizontal:!0,drag_block_vertical:!0,prevent_default:!0}).on("drag",function(event){event.gesture.preventDefault();var deltaX=event.gesture.deltaX-lastDragDeltaX,deltaY=event.gesture.deltaY-lastDragDeltaY;bgPosX+=deltaX,bgPosY+=deltaY,updateBgStyle(),lastDragDeltaX=event.gesture.deltaX,lastDragDeltaY=event.gesture.deltaY});var pinchInitBgWidth,pinchInitBgHeight;Hammer(img).on("pinch",function(event){event.gesture.preventDefault(),pinchInitBgWidth||(pinchInitBgWidth=bgWidth,pinchInitBgHeight=bgHeight),bgWidth=pinchInitBgWidth*event.gesture.scale,bgHeight=pinchInitBgHeight*event.gesture.scale,updateBgStyle()}),Hammer(img).on("release",function(){lastDragDeltaX=lastDragDeltaY=0,pinchInitBgWidth=pinchInitBgHeight=0}),Hammer(img).on("doubletap",function(event){event.gesture.preventDefault(),reset()})}function initKeyboardBindings(){var keyboardDeltaX=5,keyboardDeltaY=5;$img.mouseover(function(){isActive=!0}).mouseout(function(){isActive=!1}),$(document).keydown(function(e){if(!isActive)return!0;switch(e.keyCode){case 37:return bgPosX-=keyboardDeltaX,updateBgStyle(),!1;case 39:return bgPosX+=keyboardDeltaX,updateBgStyle(),!1;case 38:return bgPosY-=keyboardDeltaY,updateBgStyle(),!1;case 40:return bgPosY+=keyboardDeltaY,updateBgStyle(),!1}})}var settings,img,$img,origSrc,width,height,currentWidth,currentHeight,naturalWidth,naturalHeight,bgWidth,bgHeight,bgPosX,bgPosY,transparentPNG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==",defaults={zoom:.01,maxZoomContainerPct:1},isActive=!0;return settings=$.extend({},defaults,options),img=image,$img=$(img),origSrc=img.src,img.complete?loaded():$img.one("load",loaded),{resize:resize,src:origSrc,origWidth:width,origHeight:height,bgSize:bgSize}}}(),/*! Hammer.JS - v1.0.5 - 2013-04-07
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2013 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */
function(window,undefined){"use strict";function setup(){if(!Hammer.READY){Hammer.event.determineEventTypes();for(var name in Hammer.gestures)Hammer.gestures.hasOwnProperty(name)&&Hammer.detection.register(Hammer.gestures[name]);Hammer.event.onTouch(Hammer.DOCUMENT,Hammer.EVENT_MOVE,Hammer.detection.detect),Hammer.event.onTouch(Hammer.DOCUMENT,Hammer.EVENT_END,Hammer.detection.detect),Hammer.READY=!0}}var Hammer=function(element,options){return new Hammer.Instance(element,options||{})};Hammer.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Hammer.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,Hammer.HAS_TOUCHEVENTS="ontouchstart"in window,Hammer.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,Hammer.NO_MOUSEEVENTS=Hammer.HAS_TOUCHEVENTS&&navigator.userAgent.match(Hammer.MOBILE_REGEX),Hammer.EVENT_TYPES={},Hammer.DIRECTION_DOWN="down",Hammer.DIRECTION_LEFT="left",Hammer.DIRECTION_UP="up",Hammer.DIRECTION_RIGHT="right",Hammer.POINTER_MOUSE="mouse",Hammer.POINTER_TOUCH="touch",Hammer.POINTER_PEN="pen",Hammer.EVENT_START="start",Hammer.EVENT_MOVE="move",Hammer.EVENT_END="end",Hammer.DOCUMENT=document,Hammer.plugins={},Hammer.READY=!1,Hammer.Instance=function(element,options){var self=this;return setup(),this.element=element,this.enabled=!0,this.options=Hammer.utils.extend(Hammer.utils.extend({},Hammer.defaults),options||{}),this.options.stop_browser_behavior&&Hammer.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),Hammer.event.onTouch(element,Hammer.EVENT_START,function(ev){self.enabled&&Hammer.detection.startDetect(self,ev)}),this},Hammer.Instance.prototype={on:function(gesture,handler){for(var gestures=gesture.split(" "),t=0;t<gestures.length;t++)this.element.addEventListener(gestures[t],handler,!1);return this},off:function(gesture,handler){for(var gestures=gesture.split(" "),t=0;t<gestures.length;t++)this.element.removeEventListener(gestures[t],handler,!1);return this},trigger:function(gesture,eventData){var event=Hammer.DOCUMENT.createEvent("Event");event.initEvent(gesture,!0,!0),event.gesture=eventData;var element=this.element;return Hammer.utils.hasParent(eventData.target,element)&&(element=eventData.target),element.dispatchEvent(event),this},enable:function(state){return this.enabled=state,this}};var last_move_event=null,enable_detect=!1,touch_triggered=!1;Hammer.event={bindDom:function(element,type,handler){for(var types=type.split(" "),t=0;t<types.length;t++)element.addEventListener(types[t],handler,!1)},onTouch:function(element,eventType,handler){var self=this;this.bindDom(element,Hammer.EVENT_TYPES[eventType],function(ev){var sourceEventType=ev.type.toLowerCase();if(!sourceEventType.match(/mouse/)||!touch_triggered){(sourceEventType.match(/touch/)||sourceEventType.match(/pointerdown/)||sourceEventType.match(/mouse/)&&1===ev.which)&&(enable_detect=!0),sourceEventType.match(/touch|pointer/)&&(touch_triggered=!0);var count_touches=0;enable_detect&&(Hammer.HAS_POINTEREVENTS&&eventType!=Hammer.EVENT_END?count_touches=Hammer.PointerEvent.updatePointer(eventType,ev):sourceEventType.match(/touch/)?count_touches=ev.touches.length:touch_triggered||(count_touches=sourceEventType.match(/up/)?0:1),count_touches>0&&eventType==Hammer.EVENT_END?eventType=Hammer.EVENT_MOVE:count_touches||(eventType=Hammer.EVENT_END),count_touches||null===last_move_event?last_move_event=ev:ev=last_move_event,handler.call(Hammer.detection,self.collectEventData(element,eventType,ev)),Hammer.HAS_POINTEREVENTS&&eventType==Hammer.EVENT_END&&(count_touches=Hammer.PointerEvent.updatePointer(eventType,ev))),count_touches||(last_move_event=null,enable_detect=!1,touch_triggered=!1,Hammer.PointerEvent.reset())}})},determineEventTypes:function(){var types;types=Hammer.HAS_POINTEREVENTS?Hammer.PointerEvent.getEvents():Hammer.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],Hammer.EVENT_TYPES[Hammer.EVENT_START]=types[0],Hammer.EVENT_TYPES[Hammer.EVENT_MOVE]=types[1],Hammer.EVENT_TYPES[Hammer.EVENT_END]=types[2]},getTouchList:function(ev){return Hammer.HAS_POINTEREVENTS?Hammer.PointerEvent.getTouchList():ev.touches?ev.touches:[{identifier:1,pageX:ev.pageX,pageY:ev.pageY,target:ev.target}]},collectEventData:function(element,eventType,ev){var touches=this.getTouchList(ev,eventType),pointerType=Hammer.POINTER_TOUCH;return(ev.type.match(/mouse/)||Hammer.PointerEvent.matchType(Hammer.POINTER_MOUSE,ev))&&(pointerType=Hammer.POINTER_MOUSE),{center:Hammer.utils.getCenter(touches),timeStamp:(new Date).getTime(),target:ev.target,touches:touches,eventType:eventType,pointerType:pointerType,srcEvent:ev,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return Hammer.detection.stopDetect()}}}},Hammer.PointerEvent={pointers:{},getTouchList:function(){var self=this,touchlist=[];return Object.keys(self.pointers).sort().forEach(function(id){touchlist.push(self.pointers[id])}),touchlist},updatePointer:function(type,pointerEvent){return type==Hammer.EVENT_END?this.pointers={}:(pointerEvent.identifier=pointerEvent.pointerId,this.pointers[pointerEvent.pointerId]=pointerEvent),Object.keys(this.pointers).length},matchType:function(pointerType,ev){if(!ev.pointerType)return!1;var types={};return types[Hammer.POINTER_MOUSE]=ev.pointerType==ev.MSPOINTER_TYPE_MOUSE||ev.pointerType==Hammer.POINTER_MOUSE,types[Hammer.POINTER_TOUCH]=ev.pointerType==ev.MSPOINTER_TYPE_TOUCH||ev.pointerType==Hammer.POINTER_TOUCH,types[Hammer.POINTER_PEN]=ev.pointerType==ev.MSPOINTER_TYPE_PEN||ev.pointerType==Hammer.POINTER_PEN,types[pointerType]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},Hammer.utils={extend:function(dest,src,merge){for(var key in src)dest[key]!==undefined&&merge||(dest[key]=src[key]);return dest},hasParent:function(node,parent){for(;node;){if(node==parent)return!0;node=node.parentNode}return!1},getCenter:function(touches){for(var valuesX=[],valuesY=[],t=0,len=touches.length;len>t;t++)valuesX.push(touches[t].pageX),valuesY.push(touches[t].pageY);return{pageX:(Math.min.apply(Math,valuesX)+Math.max.apply(Math,valuesX))/2,pageY:(Math.min.apply(Math,valuesY)+Math.max.apply(Math,valuesY))/2}},getVelocity:function(delta_time,delta_x,delta_y){return{x:Math.abs(delta_x/delta_time)||0,y:Math.abs(delta_y/delta_time)||0}},getAngle:function(touch1,touch2){var y=touch2.pageY-touch1.pageY,x=touch2.pageX-touch1.pageX;return 180*Math.atan2(y,x)/Math.PI},getDirection:function(touch1,touch2){var x=Math.abs(touch1.pageX-touch2.pageX),y=Math.abs(touch1.pageY-touch2.pageY);return x>=y?touch1.pageX-touch2.pageX>0?Hammer.DIRECTION_LEFT:Hammer.DIRECTION_RIGHT:touch1.pageY-touch2.pageY>0?Hammer.DIRECTION_UP:Hammer.DIRECTION_DOWN},getDistance:function(touch1,touch2){var x=touch2.pageX-touch1.pageX,y=touch2.pageY-touch1.pageY;return Math.sqrt(x*x+y*y)},getScale:function(start,end){return start.length>=2&&end.length>=2?this.getDistance(end[0],end[1])/this.getDistance(start[0],start[1]):1},getRotation:function(start,end){return start.length>=2&&end.length>=2?this.getAngle(end[1],end[0])-this.getAngle(start[1],start[0]):0},isVertical:function(direction){return direction==Hammer.DIRECTION_UP||direction==Hammer.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(element,css_props){var prop,vendors=["webkit","khtml","moz","ms","o",""];if(css_props&&element.style){for(var i=0;i<vendors.length;i++)for(var p in css_props)css_props.hasOwnProperty(p)&&(prop=p,vendors[i]&&(prop=vendors[i]+prop.substring(0,1).toUpperCase()+prop.substring(1)),element.style[prop]=css_props[p]);"none"==css_props.userSelect&&(element.onselectstart=function(){return!1})}}},Hammer.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(inst,eventData){this.current||(this.stopped=!1,this.current={inst:inst,startEvent:Hammer.utils.extend({},eventData),lastEvent:!1,name:""},this.detect(eventData))},detect:function(eventData){if(this.current&&!this.stopped){eventData=this.extendEventData(eventData);for(var inst_options=this.current.inst.options,g=0,len=this.gestures.length;len>g;g++){var gesture=this.gestures[g];if(!this.stopped&&inst_options[gesture.name]!==!1&&gesture.handler.call(gesture,eventData,this.current.inst)===!1){this.stopDetect();break}}return this.current&&(this.current.lastEvent=eventData),eventData.eventType==Hammer.EVENT_END&&!eventData.touches.length-1&&this.stopDetect(),eventData}},stopDetect:function(){this.previous=Hammer.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(ev){var startEv=this.current.startEvent;if(startEv&&(ev.touches.length!=startEv.touches.length||ev.touches===startEv.touches)){startEv.touches=[];for(var i=0,len=ev.touches.length;len>i;i++)startEv.touches.push(Hammer.utils.extend({},ev.touches[i]))}var delta_time=ev.timeStamp-startEv.timeStamp,delta_x=ev.center.pageX-startEv.center.pageX,delta_y=ev.center.pageY-startEv.center.pageY,velocity=Hammer.utils.getVelocity(delta_time,delta_x,delta_y);return Hammer.utils.extend(ev,{deltaTime:delta_time,deltaX:delta_x,deltaY:delta_y,velocityX:velocity.x,velocityY:velocity.y,distance:Hammer.utils.getDistance(startEv.center,ev.center),angle:Hammer.utils.getAngle(startEv.center,ev.center),direction:Hammer.utils.getDirection(startEv.center,ev.center),scale:Hammer.utils.getScale(startEv.touches,ev.touches),rotation:Hammer.utils.getRotation(startEv.touches,ev.touches),startEvent:startEv}),ev},register:function(gesture){var options=gesture.defaults||{};return options[gesture.name]===undefined&&(options[gesture.name]=!0),Hammer.utils.extend(Hammer.defaults,options,!0),gesture.index=gesture.index||1e3,this.gestures.push(gesture),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}},Hammer.gestures=Hammer.gestures||{},Hammer.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(ev,inst){switch(ev.eventType){case Hammer.EVENT_START:clearTimeout(this.timer),Hammer.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==Hammer.detection.current.name&&inst.trigger("hold",ev)},inst.options.hold_timeout);break;case Hammer.EVENT_MOVE:ev.distance>inst.options.hold_threshold&&clearTimeout(this.timer);break;case Hammer.EVENT_END:clearTimeout(this.timer)}}},Hammer.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(ev,inst){if(ev.eventType==Hammer.EVENT_END){var prev=Hammer.detection.previous,did_doubletap=!1;if(ev.deltaTime>inst.options.tap_max_touchtime||ev.distance>inst.options.tap_max_distance)return;prev&&"tap"==prev.name&&ev.timeStamp-prev.lastEvent.timeStamp<inst.options.doubletap_interval&&ev.distance<inst.options.doubletap_distance&&(inst.trigger("doubletap",ev),did_doubletap=!0),(!did_doubletap||inst.options.tap_always)&&(Hammer.detection.current.name="tap",inst.trigger(Hammer.detection.current.name,ev))}}},Hammer.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(ev,inst){if(ev.eventType==Hammer.EVENT_END){if(inst.options.swipe_max_touches>0&&ev.touches.length>inst.options.swipe_max_touches)return;(ev.velocityX>inst.options.swipe_velocity||ev.velocityY>inst.options.swipe_velocity)&&(inst.trigger(this.name,ev),inst.trigger(this.name+ev.direction,ev))}}},Hammer.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(ev,inst){if(Hammer.detection.current.name!=this.name&&this.triggered)return inst.trigger(this.name+"end",ev),this.triggered=!1,void 0;if(!(inst.options.drag_max_touches>0&&ev.touches.length>inst.options.drag_max_touches))switch(ev.eventType){case Hammer.EVENT_START:this.triggered=!1;break;case Hammer.EVENT_MOVE:if(ev.distance<inst.options.drag_min_distance&&Hammer.detection.current.name!=this.name)return;Hammer.detection.current.name=this.name,(Hammer.detection.current.lastEvent.drag_locked_to_axis||inst.options.drag_lock_to_axis&&inst.options.drag_lock_min_distance<=ev.distance)&&(ev.drag_locked_to_axis=!0);var last_direction=Hammer.detection.current.lastEvent.direction;ev.drag_locked_to_axis&&last_direction!==ev.direction&&(ev.direction=Hammer.utils.isVertical(last_direction)?ev.deltaY<0?Hammer.DIRECTION_UP:Hammer.DIRECTION_DOWN:ev.deltaX<0?Hammer.DIRECTION_LEFT:Hammer.DIRECTION_RIGHT),this.triggered||(inst.trigger(this.name+"start",ev),this.triggered=!0),inst.trigger(this.name,ev),inst.trigger(this.name+ev.direction,ev),(inst.options.drag_block_vertical&&Hammer.utils.isVertical(ev.direction)||inst.options.drag_block_horizontal&&!Hammer.utils.isVertical(ev.direction))&&ev.preventDefault();break;case Hammer.EVENT_END:this.triggered&&inst.trigger(this.name+"end",ev),this.triggered=!1}}},Hammer.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(ev,inst){if(Hammer.detection.current.name!=this.name&&this.triggered)return inst.trigger(this.name+"end",ev),this.triggered=!1,void 0;if(!(ev.touches.length<2))switch(inst.options.transform_always_block&&ev.preventDefault(),ev.eventType){case Hammer.EVENT_START:this.triggered=!1;break;case Hammer.EVENT_MOVE:var scale_threshold=Math.abs(1-ev.scale),rotation_threshold=Math.abs(ev.rotation);if(scale_threshold<inst.options.transform_min_scale&&rotation_threshold<inst.options.transform_min_rotation)return;Hammer.detection.current.name=this.name,this.triggered||(inst.trigger(this.name+"start",ev),this.triggered=!0),inst.trigger(this.name,ev),rotation_threshold>inst.options.transform_min_rotation&&inst.trigger("rotate",ev),scale_threshold>inst.options.transform_min_scale&&(inst.trigger("pinch",ev),inst.trigger("pinch"+(ev.scale<1?"in":"out"),ev));break;case Hammer.EVENT_END:this.triggered&&inst.trigger(this.name+"end",ev),this.triggered=!1}}},Hammer.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(ev,inst){return inst.options.prevent_mouseevents&&ev.pointerType==Hammer.POINTER_MOUSE?(ev.stopDetect(),void 0):(inst.options.prevent_default&&ev.preventDefault(),ev.eventType==Hammer.EVENT_START&&inst.trigger(this.name,ev),void 0)}},Hammer.gestures.Release={name:"release",index:1/0,handler:function(ev,inst){ev.eventType==Hammer.EVENT_END&&inst.trigger(this.name,ev)}},"object"==typeof module&&"object"==typeof module.exports?module.exports=Hammer:(window.Hammer=Hammer,"function"==typeof window.define&&window.define.amd&&window.define("hammer",[],function(){return Hammer}))}(this);/*!
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */
var Hogan={};!function(Hogan,useArrayBuffer){function findInScope(key,scope,doModelGet){var val;return scope&&"object"==typeof scope&&(null!=scope[key]?val=scope[key]:doModelGet&&scope.get&&"function"==typeof scope.get&&(val=scope.get(key))),val}function createSpecializedPartial(instance,subs,partials,childText){function PartialTemplate(){}function Substitutions(){}PartialTemplate.prototype=instance,Substitutions.prototype=instance.subs;var key,partial=new PartialTemplate;partial.subs=new Substitutions,partial.subsText={},partial.ib();for(key in subs)partial.subs[key]=subs[key],partial.subsText[key]=childText;for(key in partials)partial.partials[key]=partials[key];return partial}function coerceToString(val){return String(null===val||void 0===val?"":val)}function hoganEscape(str){return str=coerceToString(str),hChars.test(str)?str.replace(rAmp,"&amp;").replace(rLt,"&lt;").replace(rGt,"&gt;").replace(rApos,"&#39;").replace(rQuot,"&quot;"):str}Hogan.Template=function(codeObj,text,compiler,options){codeObj=codeObj||{},this.r=codeObj.code||this.r,this.c=compiler,this.options=options||{},this.text=text||"",this.partials=codeObj.partials||{},this.subs=codeObj.subs||{},this.ib()},Hogan.Template.prototype={r:function(){return""},v:hoganEscape,t:coerceToString,render:function(context,partials,indent){return this.ri([context],partials||{},indent)},ri:function(context,partials,indent){return this.r(context,partials,indent)},ep:function(symbol,partials){var partial=this.partials[symbol],template=partials[partial.name];if(partial.instance&&partial.base==template)return partial.instance;if("string"==typeof template){if(!this.c)throw new Error("No compiler available.");template=this.c.compile(template,this.options)}return template?(this.partials[symbol].base=template,partial.subs&&(void 0===this.activeSub&&(partials.stackText=this.text),template=createSpecializedPartial(template,partial.subs,partial.partials,partials.stackText||this.text)),this.partials[symbol].instance=template,template):null},rp:function(symbol,context,partials,indent){var partial=this.ep(symbol,partials);return partial?partial.ri(context,partials,indent):""},rs:function(context,partials,section){var tail=context[context.length-1];if(!isArray(tail))return section(context,partials,this),void 0;for(var i=0;i<tail.length;i++)context.push(tail[i]),section(context,partials,this),context.pop()},s:function(val,ctx,partials,inverted,start,end,tags){var pass;return isArray(val)&&0===val.length?!1:("function"==typeof val&&(val=this.ms(val,ctx,partials,inverted,start,end,tags)),pass=!!val,!inverted&&pass&&ctx&&ctx.push("object"==typeof val?val:ctx[ctx.length-1]),pass)},d:function(key,ctx,partials,returnFound){var found,names=key.split("."),val=this.f(names[0],ctx,partials,returnFound),doModelGet=this.options.modelGet,cx=null;if("."===key&&isArray(ctx[ctx.length-2]))val=ctx[ctx.length-1];else for(var i=1;i<names.length;i++)found=findInScope(names[i],val,doModelGet),null!=found?(cx=val,val=found):val="";return returnFound&&!val?!1:(returnFound||"function"!=typeof val||(ctx.push(cx),val=this.mv(val,ctx,partials),ctx.pop()),val)},f:function(key,ctx,partials,returnFound){for(var val=!1,v=null,found=!1,doModelGet=this.options.modelGet,i=ctx.length-1;i>=0;i--)if(v=ctx[i],val=findInScope(key,v,doModelGet),null!=val){found=!0;break}return found?(returnFound||"function"!=typeof val||(val=this.mv(val,ctx,partials)),val):returnFound?!1:""},ls:function(func,cx,partials,text,tags){var oldTags=this.options.delimiters;return this.options.delimiters=tags,this.b(this.ct(coerceToString(func.call(cx,text)),cx,partials)),this.options.delimiters=oldTags,!1},ct:function(text,cx,partials){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(text,this.options).render(cx,partials)},b:useArrayBuffer?function(s){this.buf.push(s)}:function(s){this.buf+=s},fl:useArrayBuffer?function(){var r=this.buf.join("");return this.buf=[],r}:function(){var r=this.buf;return this.buf="",r},ib:function(){this.buf=useArrayBuffer?[]:""},ms:function(func,ctx,partials,inverted,start,end,tags){var textSource,cx=ctx[ctx.length-1],result=func.call(cx);return"function"==typeof result?inverted?!0:(textSource=this.activeSub&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(result,cx,partials,textSource.substring(start,end),tags)):result},mv:function(func,ctx,partials){var cx=ctx[ctx.length-1],result=func.call(cx);return"function"==typeof result?this.ct(coerceToString(result.call(cx)),cx,partials):result},sub:function(name,context,partials,indent){var f=this.subs[name];f&&(this.activeSub=name,f(context,partials,this,indent),this.activeSub=!1)}};var rAmp=/&/g,rLt=/</g,rGt=/>/g,rApos=/\'/g,rQuot=/\"/g,hChars=/[&<>\"\']/,isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}}("undefined"!=typeof exports?exports:Hogan),function(Hogan){function cleanTripleStache(token){"}"===token.n.substr(token.n.length-1)&&(token.n=token.n.substring(0,token.n.length-1))}function trim(s){return s.trim?s.trim():s.replace(/^\s*|\s*$/g,"")}function tagChange(tag,text,index){if(text.charAt(index)!=tag.charAt(0))return!1;for(var i=1,l=tag.length;l>i;i++)if(text.charAt(index+i)!=tag.charAt(i))return!1;return!0}function buildTree(tokens,kind,stack,customTags){var instructions=[],opener=null,tail=null,token=null;for(tail=stack[stack.length-1];tokens.length>0;){if(token=tokens.shift(),tail&&"<"==tail.tag&&!(token.tag in allowedInSuper))throw new Error("Illegal content in < super tag.");if(Hogan.tags[token.tag]<=Hogan.tags.$||isOpener(token,customTags))stack.push(token),token.nodes=buildTree(tokens,token.tag,stack,customTags);else{if("/"==token.tag){if(0===stack.length)throw new Error("Closing tag without opener: /"+token.n);if(opener=stack.pop(),token.n!=opener.n&&!isCloser(token.n,opener.n,customTags))throw new Error("Nesting error: "+opener.n+" vs. "+token.n);return opener.end=token.i,instructions}"\n"==token.tag&&(token.last=0==tokens.length||"\n"==tokens[0].tag)}instructions.push(token)}if(stack.length>0)throw new Error("missing closing tag: "+stack.pop().n);return instructions}function isOpener(token,tags){for(var i=0,l=tags.length;l>i;i++)if(tags[i].o==token.n)return token.tag="#",!0}function isCloser(close,open,tags){for(var i=0,l=tags.length;l>i;i++)if(tags[i].c==close&&tags[i].o==open)return!0}function stringifySubstitutions(obj){var items=[];for(var key in obj)items.push('"'+esc(key)+'": function(c,p,t,i) {'+obj[key]+"}");return"{ "+items.join(",")+" }"}function stringifyPartials(codeObj){var partials=[];for(var key in codeObj.partials)partials.push('"'+esc(key)+'":{name:"'+esc(codeObj.partials[key].name)+'", '+stringifyPartials(codeObj.partials[key])+"}");return"partials: {"+partials.join(",")+"}, subs: "+stringifySubstitutions(codeObj.subs)}function esc(s){return s.replace(rSlash,"\\\\").replace(rQuot,'\\"').replace(rNewline,"\\n").replace(rCr,"\\r")}function chooseMethod(s){return~s.indexOf(".")?"d":"f"}function createPartial(node,context){var prefix="<"+(context.prefix||""),sym=prefix+node.n+serialNo++;return context.partials[sym]={name:node.n,partials:{}},context.code+='t.b(t.rp("'+esc(sym)+'",c,p,"'+(node.indent||"")+'"));',sym}function tripleStache(node,context){context.code+="t.b(t.t(t."+chooseMethod(node.n)+'("'+esc(node.n)+'",c,p,0)));'}function write(s){return"t.b("+s+");"}var rIsWhitespace=/\S/,rQuot=/\"/g,rNewline=/\n/g,rCr=/\r/g,rSlash=/\\/g;Hogan.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},Hogan.scan=function(text,delimiters){function addBuf(){buf.length>0&&(tokens.push({tag:"_t",text:new String(buf)}),buf="")}function lineIsWhitespace(){for(var isAllWhitespace=!0,j=lineStart;j<tokens.length;j++)if(isAllWhitespace=Hogan.tags[tokens[j].tag]<Hogan.tags._v||"_t"==tokens[j].tag&&null===tokens[j].text.match(rIsWhitespace),!isAllWhitespace)return!1;return isAllWhitespace}function filterLine(haveSeenTag,noNewLine){if(addBuf(),haveSeenTag&&lineIsWhitespace())for(var next,j=lineStart;j<tokens.length;j++)tokens[j].text&&((next=tokens[j+1])&&">"==next.tag&&(next.indent=tokens[j].text.toString()),tokens.splice(j,1));else noNewLine||tokens.push({tag:"\n"});seenTag=!1,lineStart=tokens.length}function changeDelimiters(text,index){var close="="+ctag,closeIndex=text.indexOf(close,index),delimiters=trim(text.substring(text.indexOf("=",index)+1,closeIndex)).split(" ");return otag=delimiters[0],ctag=delimiters[delimiters.length-1],closeIndex+close.length-1}var len=text.length,IN_TEXT=0,IN_TAG_TYPE=1,IN_TAG=2,state=IN_TEXT,tagType=null,tag=null,buf="",tokens=[],seenTag=!1,i=0,lineStart=0,otag="{{",ctag="}}";for(delimiters&&(delimiters=delimiters.split(" "),otag=delimiters[0],ctag=delimiters[1]),i=0;len>i;i++)state==IN_TEXT?tagChange(otag,text,i)?(--i,addBuf(),state=IN_TAG_TYPE):"\n"==text.charAt(i)?filterLine(seenTag):buf+=text.charAt(i):state==IN_TAG_TYPE?(i+=otag.length-1,tag=Hogan.tags[text.charAt(i+1)],tagType=tag?text.charAt(i+1):"_v","="==tagType?(i=changeDelimiters(text,i),state=IN_TEXT):(tag&&i++,state=IN_TAG),seenTag=i):tagChange(ctag,text,i)?(tokens.push({tag:tagType,n:trim(buf),otag:otag,ctag:ctag,i:"/"==tagType?seenTag-otag.length:i+ctag.length}),buf="",i+=ctag.length-1,state=IN_TEXT,"{"==tagType&&("}}"==ctag?i++:cleanTripleStache(tokens[tokens.length-1]))):buf+=text.charAt(i);return filterLine(seenTag,!0),tokens};var allowedInSuper={_t:!0,"\n":!0,$:!0,"/":!0};Hogan.stringify=function(codeObj){return"{code: function (c,p,i) { "+Hogan.wrapMain(codeObj.code)+" },"+stringifyPartials(codeObj)+"}"};var serialNo=0;Hogan.generate=function(tree,text,options){serialNo=0;var context={code:"",subs:{},partials:{}};return Hogan.walk(tree,context),options.asString?this.stringify(context,text,options):this.makeTemplate(context,text,options)},Hogan.wrapMain=function(code){return'var t=this;t.b(i=i||"");'+code+"return t.fl();"},Hogan.template=Hogan.Template,Hogan.makeTemplate=function(codeObj,text,options){var template=this.makePartials(codeObj);return template.code=new Function("c","p","i",this.wrapMain(codeObj.code)),new this.template(template,text,this,options)},Hogan.makePartials=function(codeObj){var key,template={subs:{},partials:codeObj.partials,name:codeObj.name};for(key in template.partials)template.partials[key]=this.makePartials(template.partials[key]);for(key in codeObj.subs)template.subs[key]=new Function("c","p","t","i",codeObj.subs[key]);return template},Hogan.codegen={"#":function(node,context){context.code+="if(t.s(t."+chooseMethod(node.n)+'("'+esc(node.n)+'",c,p,1),'+"c,p,0,"+node.i+","+node.end+',"'+node.otag+" "+node.ctag+'")){'+"t.rs(c,p,"+"function(c,p,t){",Hogan.walk(node.nodes,context),context.code+="});c.pop();}"},"^":function(node,context){context.code+="if(!t.s(t."+chooseMethod(node.n)+'("'+esc(node.n)+'",c,p,1),c,p,1,0,0,"")){',Hogan.walk(node.nodes,context),context.code+="};"},">":createPartial,"<":function(node,context){var ctx={partials:{},code:"",subs:{},inPartial:!0};Hogan.walk(node.nodes,ctx);var template=context.partials[createPartial(node,context)];template.subs=ctx.subs,template.partials=ctx.partials},$:function(node,context){var ctx={subs:{},code:"",partials:context.partials,prefix:node.n};Hogan.walk(node.nodes,ctx),context.subs[node.n]=ctx.code,context.inPartial||(context.code+='t.sub("'+esc(node.n)+'",c,p,i);')},"\n":function(node,context){context.code+=write('"\\n"'+(node.last?"":" + i"))},_v:function(node,context){context.code+="t.b(t.v(t."+chooseMethod(node.n)+'("'+esc(node.n)+'",c,p,0)));'},_t:function(node,context){context.code+=write('"'+esc(node.text)+'"')},"{":tripleStache,"&":tripleStache},Hogan.walk=function(nodelist,context){for(var func,i=0,l=nodelist.length;l>i;i++)func=Hogan.codegen[nodelist[i].tag],func&&func(nodelist[i],context);return context},Hogan.parse=function(tokens,text,options){return options=options||{},buildTree(tokens,"",[],options.sectionTags||[])},Hogan.cache={},Hogan.cacheKey=function(text,options){return[text,!!options.asString,!!options.disableLambda,options.delimiters,!!options.modelGet].join("||")},Hogan.compile=function(text,options){options=options||{};var key=Hogan.cacheKey(text,options),template=this.cache[key];return template?template:(template=this.generate(this.parse(this.scan(text,options.delimiters),text,options),text,options),this.cache[key]=template)}}("undefined"!=typeof exports?exports:Hogan),function(){var $errorIndicator=$("#js-error-indicator");window.showError=function(msg,consoleMsg){$("#error-msg").html(msg),$errorIndicator.show(),console.log("ERROR: "+msg),consoleMsg&&console.log("details: "+consoleMsg)},window.hideError=function(){$errorIndicator.hide()},window.debugLog=function(msg){console.log(msg)}}(),function(){function isScrolledToBottom($element){return $element[0].scrollHeight-$element.scrollTop()==$element.outerHeight()}function isStringEmpty(str){return null==str||!str.trim()}var PollCreator=window.PollCreator=function(options){var options=options||{},$imageSelector=$(".js-image-upload-base"),viewportClass=".js-image-upload-viewport",addChoiceClass=".js-add-choice",cancelChoiceClass=".js-cancel-choice";return this.$firstUploadBase=$imageSelector.first(),this.$firstViewPort=this.$firstUploadBase.find(viewportClass),this.$firstAddChoiceLink=this.$firstUploadBase.find(addChoiceClass),this.$firstCancelLink=this.$firstUploadBase.find(cancelChoiceClass),this.$secondUploadBase=$imageSelector.last(),this.$secondViewPort=this.$secondUploadBase.find(viewportClass),this.$secondAddChoiceLink=this.$secondUploadBase.find(addChoiceClass),this.$secondCancelLink=this.$secondUploadBase.find(cancelChoiceClass),this.$addChoiceLinks=$(addChoiceClass),this.$progressIndicator=$("#js-progress-indicator"),this.$createButton=$("#js-create-button"),this.$captionText=$("#js-caption-text"),this.$choice1Text=$("#js-choice1-text"),this.$choice2Text=$("#js-choice2-text"),this.$formTextElements=$(".js-form-text"),this.$pollForm=$("#poll-form"),this.$imageDivider=$(".js-image-divider"),this.$imageUploadsContainer=$("#js-image-uploads-container"),this.$imageSearchSection=$("#js-image-search-section"),this.$imageSearchButton=$("#js-image-search-button"),this.$imageSearchText=$("#js-image-search-text"),this.$imageSearchFilter=$("#js-image-search-filter"),this.$imageSearchFilterLink=$(".js-image-search-filter-link"),this.$imageSearchCancel=$("#js-image-search-cancel"),this.$imageSearchResultList=$("#js-image-search-results-list"),this.$imageSearchResultsTip=$("#js-image-search-results-tip"),this.$imageSearchPullUpText=$("#js-image-search-pull-up-text"),this.$imageSearchScroll=$("#js-image-search-scroll"),this.$imageSearchDomain=$("#js-image-search-domain"),this.$imageSearchNoResults=$("#js-image-search-no-results"),this.imageSearchResultItemsClass=".js-image-search-result",this.user=options.user,this.pollCreatorImage1=new PollCreatorImage(this,this.$firstUploadBase),this.pollCreatorImage1.onImageAdded=this.imageAdded,this.pollCreatorImage1.onImageAddedFailure=this.imageAddedFailure,this.pollCreatorImage1.onSearchSelected=this.firstSearchSelected,this.pollCreatorImage2=new PollCreatorImage(this,this.$secondUploadBase),this.pollCreatorImage2.onImageAdded=this.imageAdded,this.pollCreatorImage2.onImageAddedFailure=this.imageAddedFailure,this.pollCreatorImage2.onSearchSelected=this.secondSearchSelected,this.imageHeight=400,this.imageWidth=600,this.pollImageID=null,this.showFirst=!0,this.showSecond=!1,this.initPoll=options.poll,this.imageSearch=new GoogleImageSearch,this.searchVisible=!1,this.searchHasMore=!1,this.isPublicDomainSearch=!0,this.maxCaptionChars=options.max_caption||60,this.maxOptionChars=32,this.validateBrowser(),this.initBindings(),this.initTextAreaContraints(),this.initPoll?(this.pollID=this.initPoll.pollID,this.pollCreatorImage1.editEnabled=!1,this.pollCreatorImage1.addImage(this.initPoll.image.largeUrl),this.usingOriginalImage=!0):(this.pollID=null,this.usingOriginalImage=!1),this.updateAllItemsBasedOnState(),this};PollCreator.prototype.validateBrowser=function(){var browserOK=!0,details=null;"undefined"==typeof window.FileReader&&(browserOK=!1,details="File API & FileReader not available"),document.createElement("canvas").getContext||(browserOK=!1,details="browser issue: canvas unavailable"),browserOK||showError(errorMessages.browser,details)},PollCreator.prototype.initBindings=function(){var self=this;this.$addChoiceLinks.on("click",function(){return self.showFirst=!0,self.showSecond=!0,self.updateAllItemsBasedOnState(),!1}),self.$firstCancelLink.on("click",function(){return self.showSecond&&self.pollCreatorImage2.hasImage()?self.showFirst=!1:(self.showFirst=!0,self.showSecond=!1),self.pollCreatorImage1.clearImage(),self.usingOriginalImage=!1,self.pollCreatorImage1.editEnabled=!0,self.updateAllItemsBasedOnState(),!1}),self.$secondCancelLink.on("click",function(){return self.showFirst=!0,self.showSecond=!1,self.pollCreatorImage2.clearImage(),self.updateAllItemsBasedOnState(),!1}),this.$formTextElements.focus(function(){$(this).removeClass("form-error")}),this.$createButton.on("click",function(event){event.preventDefault();var formData=self.$pollForm.serialize();return self.submit(formData),!1}),this.$imageSearchButton.on("click",function(event){return event.preventDefault(),self.clearSearchResults(),self.doImageSearch(),!1}),this.$imageSearchCancel.on("click",function(){return self.clearSearch(),self.hideSearch(),!1}),this.$imageSearchFilterLink.on("click",function(){var $thisElement=$(this),searchFilterSetting=$thisElement.data("filter");return self.$imageSearchFilter.val(searchFilterSetting),self.$imageSearchFilterLink.not($thisElement).removeClass("active"),$thisElement.addClass("active"),self.$imageSearchDomain.toggle("site"==searchFilterSetting),self.$imageSearchText.focus(),self.clearSearchResults(),self.doImageSearch(),!1}),$(document).on("click",this.imageSearchResultItemsClass,function(){self.searchImageSelected(this)}),$("textarea").on("blur keyup",function(){self.updateReadyToCreateStatus()}),$(window).on("resize",function(){self.resizeImages()}),this.initSearchScroll()},PollCreator.prototype.doImageSearch=function(){function success(results){console.log(results),self.searchHasMore=null!=results.queries.nextPage,self.searchHasMore?self.$imageSearchPullUpText.show():self.$imageSearchPullUpText.hide(),results.items?(self.$imageSearchNoResults.hide(),self.displaySearchResults(results.items)):(self.$imageSearchNoResults.show(),self.$imageSearchResultsTip.hide()),self.isSearching=!1}function failure(jqXHR,textStatus,error){console.log("image search request failed: "+textStatus),Honeybadger.notify(new Error("Error in poll doImageSearch: "+jqXHR.responseText+";"+textStatus+"; "+error)),self.isSearching=!1}var self=this,searchTerm=this.$imageSearchText.val();if(searchTerm){var searchFilter=this.$imageSearchFilter.val(),site=this.$imageSearchDomain.val(),options={};this.isPublicDomainSearch=!1,"cc"==searchFilter?(options.rights="(cc_publicdomain|cc_attribute|cc_sharealike|cc_nonderived).-(cc_noncommercial)",this.isPublicDomainSearch=!0):"amazon"==searchFilter?options.site="amazon.com":"site"==searchFilter&&null!=site&&(options.site=site,this.updateSiteSearchDomain(site)),self.isSearching=!0,this.imageSearch.search(searchTerm,success,failure,options)}},PollCreator.prototype.searchImageSelected=function(img){var url=$(img).data("origUrl"),options={url:url,contextUrl:$(img).data("origContextUrl"),title:$(img).data("title"),publicDomain:this.isPublicDomainSearch};2==this.imageSearchSelected?this.pollCreatorImage2.addProxyImage(url,options):this.pollCreatorImage1.addProxyImage(url,options),this.hideSearch()},PollCreator.prototype.firstSearchSelected=function(){1!=this.imageSearchSelected&&this.clearSearch(),this.imageSearchSelected=1,this.showSearch()},PollCreator.prototype.secondSearchSelected=function(){2!=this.imageSearchSelected&&this.clearSearch(),this.imageSearchSelected=2,this.showSearch()},PollCreator.prototype.clearSearch=function(){this.$imageSearchText.val(null),this.clearSearchResults()},PollCreator.prototype.clearSearchResults=function(){this.searchHasMore=!1,this.imageSearch.page=1,this.publicDomain=!1,this.$imageSearchResultList.empty(),this.$imageSearchResultsTip.show(),this.$imageSearchPullUpText.hide(),this.$imageSearchNoResults.hide()},PollCreator.prototype.showSearch=function(){this.$imageSearchSection.show(),this.$imageSearchText.focus(),this.searchVisible=!0},PollCreator.prototype.hideSearch=function(){this.searchVisible=!1,this.$imageSearchSection.hide()},PollCreator.prototype.displaySearchResults=function(results){if(results){this.$imageSearchResultsTip.hide();var template=HoganTemplates["poll-create/templates/image_search_result"],rendered=template.render({results:results});1==this.imageSearch.page?this.$imageSearchResultList.html(rendered):this.$imageSearchResultList.append(rendered)}},PollCreator.prototype.initSearchScroll=function(){function searchNextPage(){self.searchVisible&&!self.isSearching&&self.searchHasMore&&(self.imageSearch.page+=1,self.doImageSearch())}var bottomScrollMarginTrigger=30,self=this;$(window).scroll(function(){var scrollMarginBottom=$(document).height()-$("footer").height()-($(window).scrollTop()+$(window).height());bottomScrollMarginTrigger>scrollMarginBottom&&searchNextPage()}),this.$imageSearchScroll.scroll(function(){isScrolledToBottom(self.$imageSearchScroll)&&searchNextPage()})},PollCreator.prototype.initTextAreaContraints=function(){$("textarea").autosize(),this.$captionText.limiter(this.maxCaptionChars),this.$choice1Text.limiter(this.maxOptionChars),this.$choice2Text.limiter(this.maxOptionChars)},PollCreator.prototype.updateAllItemsBasedOnState=function(){this.showChoices(),this.updateAddAnotherLinks(),this.updateReadyToCreateStatus()},PollCreator.prototype.showChoices=function(){this.$firstUploadBase.toggle(this.showFirst),this.$secondUploadBase.toggle(this.showSecond),this.$secondCancelLink.toggle(this.pollCreatorImage2.hasImage()),this.$firstCancelLink.toggle(this.pollCreatorImage1.hasImage()),this.$firstViewPort.toggle(this.showFirst),this.$secondViewPort.toggle(this.showSecond),this.resizeImages(),this.$imageDivider.toggle(this.showFirst&&this.showSecond&&this.pollCreatorImage1.hasImage()&&this.pollCreatorImage2.hasImage())},PollCreator.prototype.resizeImages=function(){var maxWidth=Math.min(this.$imageUploadsContainer.width(),this.imageWidth),reductionPct=maxWidth/this.imageWidth,adjustedHeight=reductionPct*this.imageHeight;if(this.showFirst&&this.showSecond){var halfWidth=Math.floor(maxWidth/2);this.$firstViewPort.width(halfWidth),this.$secondViewPort.width(halfWidth)}else this.$firstViewPort.width(maxWidth),this.$secondViewPort.width(maxWidth);this.$firstViewPort.height(adjustedHeight),this.$secondViewPort.height(adjustedHeight),this.pollCreatorImage1.reSizeToContainer(),this.pollCreatorImage2.reSizeToContainer()},PollCreator.prototype.updateAddAnotherLinks=function(){var image1=this.pollCreatorImage1.hasImage(),image2=this.pollCreatorImage2.hasImage();this.usingOriginalImage?(this.$firstAddChoiceLink.hide(),this.$secondAddChoiceLink.hide()):image1&&image2&&this.showFirst&&this.showSecond?(this.$firstAddChoiceLink.hide(),this.$secondAddChoiceLink.hide()):image2&&!this.showFirst?(this.$firstAddChoiceLink.hide(),this.$secondAddChoiceLink.show()):image1&&!this.showSecond?(this.$firstAddChoiceLink.show(),this.$secondAddChoiceLink.hide()):(this.$firstAddChoiceLink.hide(),this.$secondAddChoiceLink.hide())},PollCreator.prototype.updateReadyToCreateStatus=function(){var hasErrors=this.formErrors().length>0;this.$createButton.toggleClass("pollbut_hl",!hasErrors)},PollCreator.prototype.imageAdded=function(){hideError(),this.updateAllItemsBasedOnState()},PollCreator.prototype.imageAddedFailure=function(){showError(errorMessages.imageLoadFailure)},PollCreator.prototype.formErrors=function(){var errors=[];return isStringEmpty(this.$captionText.val())&&(this.$captionText.addClass("form-error"),errors.push(errorMessages.questionMissing)),isStringEmpty(this.$choice1Text.val())&&(this.$choice1Text.addClass("form-error"),errors.push(errorMessages.optionMissing)),isStringEmpty(this.$choice2Text.val())&&(this.$choice2Text.addClass("form-error"),errors.indexOf(errorMessages.optionMissing)<0&&errors.push(errorMessages.optionMissing)),this.pollCreatorImage1.hasImage()||this.pollCreatorImage2.hasImage()||errors.push(errorMessages.imageMissing),errors},PollCreator.prototype.validateForm=function(){var errors=this.formErrors();return errors.length>0?(showError(errors[0]),!1):!0},PollCreator.prototype.submit=function(formData){if(this.validateForm()){hideError(),this.$progressIndicator.show(),this.$createButton.hide();var self=this;self.usingOriginalImage?self.update(formData,null):self.processImages().done(function(canvas){self.initPoll?self.update(formData,canvas):self.create(formData,canvas)})}},PollCreator.prototype.update=function(formData,canvas){var self=this;$.ajax({url:"/api/v4/polls/"+this.pollID,type:"PUT",dataType:"json",data:formData}).done(function(returnData){if(canvas){var uploadData=returnData.uploadData;canvas.toBlob(function(blob){self.uploadImage(uploadData.postUrl,uploadData.formData,blob)},"image/jpeg")}else self.submitSuccess()}).fail(function(jqXHR,textStatus,error){Honeybadger.notify(new Error("Error in poll update: "+jqXHR.responseText+";"+textStatus+"; "+error)),self.submitFailure(errorMessages.unknown)})},PollCreator.prototype.create=function(formData,canvas){var self=this;$.ajax({url:"/api/v4/polls",type:"POST",dataType:"json",data:formData}).done(function(returnData){self.pollID=returnData.pollID,self.pollImageID=returnData.imageID;var uploadData=returnData.uploadData;canvas.toBlob(function(blob){self.uploadImage(uploadData.postUrl,uploadData.formData,blob)},"image/jpeg")}).fail(function(jqXHR,textStatus,error){Honeybadger.notify(new Error("Error in poll create: "+jqXHR.responseText+";"+textStatus+"; "+error)),self.submitFailure(errorMessages.unknown)})},PollCreator.prototype.logToServer=function(params){$.ajax({url:"/api/v4/polls/"+this.pollID+"/log",type:"POST",data:{log_info:params}})},PollCreator.prototype.uploadImage=function(url,formData,canvasBlob,numTries){function logInfo(msg){return{msg:msg,time:new Date,poll_id:self.pollID,url:url,key:formData.key,data_size:canvasBlob.size,user_agent:navigator.userAgent}}var self=this;if(null==canvasBlob||0==canvasBlob.size)return self.submitFailure(errorMessages.imageProcess),void 0;var fd=new FormData;fd.append("AWSAccessKeyId",formData.AWSAccessKeyId),fd.append("policy",formData.policy),fd.append("signature",formData.signature),fd.append("key",formData.key),fd.append("acl",formData.acl),fd.append("Content-Type","image/jpeg"),fd.append("file",canvasBlob,"poll-image.jpeg"),self.logToServer(logInfo("image upload start")),$.ajax({url:url,type:"POST",data:fd,processData:!1,contentType:!1}).done(function(){self.notifyImageUploaded(),self.logToServer(logInfo("image upload finished"))}).fail(function(jqXHR){self.submitFailure(errorMessages.imageUpload);var errMsg="Error in poll uploadImage: "+jqXHR.responseText+";"+jqXHR.status+"; "+jqXHR.statusText;Honeybadger.notify(new Error(errMsg),{context:logInfo(errMsg)}),self.logToServer(logInfo(errMsg)),numTries=numTries||1,2>numTries&&(console.log("Attempting again"),numTries+=1,self.uploadImage(url,formData,canvasBlob,numTries))})},PollCreator.prototype.notifyImageUploaded=function(){var self=this,data={image_id:self.pollImageID};this.pollCreatorImage1.hasImage()&&this.pollCreatorImage1.sourceOptions&&(data.first_image_full_url=this.pollCreatorImage1.sourceOptions.url,data.first_image_context_url=this.pollCreatorImage1.sourceOptions.contextUrl,data.first_title=this.pollCreatorImage1.sourceOptions.title,this.pollCreatorImage1.sourceOptions.publicDomain&&(data.first_public_domain=!0)),this.pollCreatorImage2.hasImage()&&this.pollCreatorImage2.sourceOptions&&(data.second_image_full_url=this.pollCreatorImage2.sourceOptions.url,data.second_image_context_url=this.pollCreatorImage2.sourceOptions.contextUrl,data.second_title=this.pollCreatorImage2.sourceOptions.title,this.pollCreatorImage2.sourceOptions.publicDomain&&(data.second_public_domain=!0)),$.ajax({url:"/api/v4/polls/"+self.pollID+"/image_uploaded",type:"POST",dataType:"json",data:data}).done(function(){self.submitSuccess()}).fail(function(jqXHR,textStatus,error){self.submitFailure(errorMessages.unknown),Honeybadger.notify(new Error("Error in poll notifyImageUploaded: "+jqXHR.responseText+";"+textStatus+"; "+error))}).always(function(){self.$progressIndicator.hide()})},PollCreator.prototype.updateSiteSearchDomain=function(site){var self=this;$.ajax({url:"/api/v4/users/"+self.user.userID,type:"PUT",dataType:"json",data:{site_search_domain:site}}).fail(function(data){console.log("error updating user site search preferences:"),console.log(data)})},PollCreator.prototype.submitFailure=function(msg,details){this.$progressIndicator.hide(),this.$createButton.show(),showError(msg,details)},PollCreator.prototype.submitSuccess=function(){this.$progressIndicator.hide(),window.location.href="/publishers/polls/"+this.pollID+"/settings"},PollCreator.prototype.processImages=function(){var croppedImage1Promise,croppedImage2Promise,self=this,deferred=$.Deferred();return this.showFirst&&this.showSecond&&this.pollCreatorImage1.hasImage()&&this.pollCreatorImage2.hasImage()?(croppedImage1Promise=this.pollCreatorImage1.crop(this.imageWidth/2,this.imageHeight),croppedImage2Promise=this.pollCreatorImage2.crop(this.imageWidth/2,this.imageHeight)):this.showFirst?(croppedImage1Promise=this.pollCreatorImage1.crop(this.imageWidth,this.imageHeight),croppedImage2Promise=$.Deferred().resolve(null)):this.showSecond&&(croppedImage1Promise=$.Deferred().resolve(null),croppedImage2Promise=this.pollCreatorImage2.crop(this.imageWidth,this.imageHeight)),$.when(croppedImage1Promise,croppedImage2Promise).done(function(croppedImage1,croppedImage2){var canvas=PollCreatorImage.compositeImagesToCanvas(croppedImage1,croppedImage2,self.imageWidth,self.imageHeight);deferred.resolve(canvas)}),deferred.promise()}}(),function(){function getProbableImageURL(e){var types=e.dataTransfer.types;if(null==types)return null;for(var i=0;i<types.length;i++){var type=types[i],content=e.dataTransfer.getData(type);console.log(type+" : "+content);var googSearchPattern=new RegExp("imgurl=(http(s?)://[^?&]*)"),googSearchMatch=googSearchPattern.exec(content);if(googSearchMatch)return googSearchMatch[1];var imgSrcPattern=new RegExp('src="([^"]*)"'),imgSrcMatch=imgSrcPattern.exec(content);if(imgSrcMatch)return imgSrcMatch[1]}var text=e.dataTransfer.getData("Text");console.log("text: "+text);var isImagePattern=/(https?:\/\/.*\.(?:png|jpg))/i;return isImagePattern.exec(text)?text:void 0}var PollCreatorImage=window.PollCreatorImage=function(pollCreator,baseDivSelector){return this.$baseDiv=baseDivSelector,this.$viewport=baseDivSelector.find(".js-image-upload-viewport"),this.$addImageLink=baseDivSelector.find(".js-add-image"),this.$fileInput=baseDivSelector.find("input[type=file]"),this.$image=baseDivSelector.find(".js-selected-image"),this.$loadingIndicator=baseDivSelector.find(".js-image-loading-indicator"),this.$cancelButton=baseDivSelector.find(".js-cancel-choice"),this.$searchSelectedLink=baseDivSelector.find(".js-start-search"),this.pollCreator=pollCreator,this.imageDataURL=null,this.crossOrigin=!1,this.maxFileSize=1e7,this.imageZoom=null,this.sourceOptions=null,this.onImageAdded=null,this.onImageAddedFailure=null,this.onSearchSelected=null,this.initFileDrop(),this.initBindings(),this.$image.hide(),this.$image.css("cursor","move"),this.editEnabled=!0,this};PollCreatorImage.prototype.clearImage=function(){this.imageDataURL=null,this.sourceOptions=null,this.crossOrigin=!1,this.$image.attr("src",null),this.$image.attr("style",null),this.$image.attr("width",null),this.$image.attr("height",null),this.$addImageLink.show(),this.$image.hide(),this.$loadingIndicator.hide(),this.$cancelButton.hide(),this.$searchSelectedLink.show(),this.$fileInput.replaceWith(this.$fileInput=this.$fileInput.clone(!0))},PollCreatorImage.prototype.hasImage=function(){return null!=this.imageDataURL},PollCreatorImage.prototype.initBindings=function(){var self=this;this.$addImageLink.on("click",function(){return self.$fileInput.click(),!1}),this.$searchSelectedLink.on("click",function(){return self.onSearchSelected.call(self.pollCreator),!1})},PollCreatorImage.prototype.initFileDrop=function(){var dropElement=this.$viewport[0],self=this;dropElement.ondragover=function(){return self.$viewport.addClass("hover"),!1},dropElement.ondragend=function(){return self.$viewport.removeClass("hover"),!1},dropElement.ondrop=function(e){if(self.$viewport.removeClass("hover"),e.preventDefault(),self.editEnabled){var file=e.dataTransfer.files[0];
if(!file){var probableUrl=getProbableImageURL(e);return console.log("probable image URL: "+probableUrl),probableUrl?(self.addProxyImage(probableUrl),void 0):(showError(errorMessages.notAnImage),void 0)}return self.fileAdded(file),!1}},this.$fileInput.on("change",function(){self.fileAdded(this.files[0])})},PollCreatorImage.prototype.addProxyImage=function(url,sourceOptions){this.$cancelButton.show();var proxyURL="/image_processing?"+url.replace(/^https\:/,"http:");this.crossOrigin=!0,this.addImage(proxyURL),this.sourceOptions=$.extend({url:url},sourceOptions)},PollCreatorImage.prototype.fileAdded=function(file){if(this.editEnabled){debugLog(file),hideError();var self=this;return null!=file&&file.type&&file.type.match(/^image\//)?file.size>this.maxFileSize?(showError(errorMessages.imageSize),void 0):(loadImage.parseMetaData(file,function(data){var options={maxWidth:1e3,canvas:!0};data.exif&&(options.orientation=data.exif.get("Orientation")),loadImage(file,function(loadedImageCanvas){return"error"===loadedImageCanvas.type?(showError(errorMessages.imageType),void 0):(self.addImage(loadedImageCanvas.toDataURL()),void 0)},options)}),void 0):(showError(errorMessages.imageType),void 0)}},PollCreatorImage.prototype.reSizeToContainer=function(){var newWidth=this.$viewport.width(),newHeight=this.$viewport.height();this.$image.width(newWidth),this.$image.height(newHeight),this.imageZoom&&this.imageZoom.resize(newWidth,newHeight)},PollCreatorImage.prototype.initSizeToContainer=function(){var $img=this.$image,width=this.$viewport.width(),height=this.$viewport.height();if($img.width()<$img.height()?$img.width(width):$img.height(height),$img.width()<width){var scale=width/$img.width();$img.width(width),$img.height($img.height()*scale)}if($img.height()<height){var scale=height/$img.height();$img.height(height),$img.width($img.width()*scale)}if(this.editEnabled){var centeredOffsetWidth=$img.width()/2-width/2,centeredOffsetHeight=$img.height()/2-height/2;this.imageZoom=new ImageZoom($img[0],{offsetX:-centeredOffsetWidth,offsetY:-centeredOffsetHeight,initZoom:.1})}},PollCreatorImage.prototype.addImage=function(url){function handleError(){self.$image.unbind("load"),clearTimeout(imagesTimer),console.log("error loading image: "+url),self.clearImage(),self.onImageAddedFailure.call(self.pollCreator)}console.log("adding image: "+url);var self=this;this.$addImageLink.hide(),this.$searchSelectedLink.hide(),this.$loadingIndicator.show(),this.imageDataURL=url,this.$image.attr("src",url);var imagesTimer=setTimeout(handleError,1e4);this.$image.load(function(){clearTimeout(imagesTimer),self.$image.unbind("load"),self.initSizeToContainer(),self.$loadingIndicator.hide(),self.$image.show(),self.onImageAdded.call(self.pollCreator)}).error(handleError)},PollCreatorImage.prototype.crop=function(width,height){var canvas=document.createElement("canvas"),context=canvas.getContext&&canvas.getContext("2d");canvas.width=width,canvas.height=height,context.fillStyle="#ffffff",context.fillRect(0,0,canvas.width,canvas.height);var viewPortWidth=this.$viewport.width(),viewPortHeight=this.$viewport.height(),bg=this.imageZoom.bgSize(),currentWidth=bg.width,currentHeight=bg.height,currentOffsetX=bg.offsetX,currentOffsetY=bg.offsetY,enlargementX=width/viewPortWidth,imageWidth=currentWidth*enlargementX,adjustedOffsetX=currentOffsetX*enlargementX,enlargementY=height/viewPortHeight,imageHeight=currentHeight*enlargementY,adjustedOffsetY=currentOffsetY*enlargementY,deferred=$.Deferred(),image=new Image;return this.crossOrigin&&(image.crossOrigin="Anonymous"),image.onload=function(){image.width=imageWidth,image.height=imageHeight,console.log("cropping image to "+width+"x"+height+"; image width: "+imageWidth+"; height: "+imageHeight+" ; offsetX: "+adjustedOffsetX+"; offsetY: "+adjustedOffsetY),context.drawImage(image,adjustedOffsetX,adjustedOffsetY,imageWidth,imageHeight);var resultImage=new Image;resultImage.onload=function(){deferred.resolve(resultImage)},resultImage.src=canvas.toDataURL("image/jpeg")},image.src=this.imageZoom.src,deferred.promise()},PollCreatorImage.compositeImagesToCanvas=function(imageA,imageB,width,height){var canvas=document.createElement("canvas");canvas.width=width,canvas.height=height;var context=canvas.getContext&&canvas.getContext("2d");context.fillStyle="#ffffff",context.fillRect(0,0,canvas.width,canvas.height);var image1=imageA||imageB,image2=imageA&&imageB?imageB:null;return image2?(context.drawImage(image1,0,0,width/2,height),context.drawImage(image2,width/2,0,width/2,height),context.beginPath(),context.moveTo(width/2-1,0),context.lineTo(width/2+1,height),context.lineWidth=2,context.strokeStyle="#E1E1E1",context.stroke()):context.drawImage(image1,0,0,width,height),canvas},PollCreatorImage.debugShowCanvas=function(canvas){$("footer").append("<hr />").append(canvas)}}(),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["poll-create/templates/image_search_result"]=new Hogan.Template({code:function(c,p,i){var t=this;return t.b(i=i||""),t.s(t.f("results",c,p,1),c,p,0,12,204,"{{ }}")&&(t.rs(c,p,function(c,p,t){t.b("<li>"),t.b("\n"+i),t.b('  <img class="js-image-search-result" src="'),t.b(t.v(t.d("image.thumbnailLink",c,p,0))),t.b('" data-orig-url="'),t.b(t.v(t.f("link",c,p,0))),t.b('" data-orig-context-url="'),t.b(t.v(t.d("image.contextLink",c,p,0))),t.b('" data-title="'),t.b(t.v(t.f("title",c,p,0))),t.b('" alt="'),t.b(t.v(t.f("title",c,p,0))),t.b('"/>'),t.b("\n"+i),t.b("</li>"),t.b("\n"+i)}),c.pop()),t.fl()},partials:{},subs:{}},"",Hogan,{}),function(e){var t,o={className:"autosizejs",append:"",callback:!1,resizeDelay:10},i='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>',n=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],s=e(i).data("autosize",!0)[0];s.style.lineHeight="99px","99px"===e(s).css("lineHeight")&&n.push("lineHeight"),s.style.lineHeight="",e.fn.autosize=function(i){return this.length?(i=e.extend({},o,i||{}),s.parentNode!==document.body&&e(document.body).append(s),this.each(function(){function o(){var t,o;"getComputedStyle"in window?(t=window.getComputedStyle(u,null),o=u.getBoundingClientRect().width,e.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(e,i){o-=parseInt(t[i],10)}),s.style.width=o+"px"):s.style.width=Math.max(p.width(),0)+"px"}function a(){var a={};if(t=u,s.className=i.className,d=parseInt(p.css("maxHeight"),10),e.each(n,function(e,t){a[t]=p.css(t)}),e(s).css(a),o(),window.chrome){var r=u.style.width;u.style.width="0px",u.offsetWidth,u.style.width=r}}function r(){var e,n;t!==u?a():o(),s.value=u.value+i.append,s.style.overflowY=u.style.overflowY,n=parseInt(u.style.height,10),s.scrollTop=0,s.scrollTop=9e4,e=s.scrollTop,d&&e>d?(u.style.overflowY="scroll",e=d):(u.style.overflowY="hidden",c>e&&(e=c)),e+=w,n!==e&&(u.style.height=e+"px",f&&i.callback.call(u,u))}function l(){clearTimeout(h),h=setTimeout(function(){var e=p.width();e!==g&&(g=e,r())},parseInt(i.resizeDelay,10))}var d,c,h,u=this,p=e(u),w=0,f=e.isFunction(i.callback),z={height:u.style.height,overflow:u.style.overflow,overflowY:u.style.overflowY,wordWrap:u.style.wordWrap,resize:u.style.resize},g=p.width();p.data("autosize")||(p.data("autosize",!0),("border-box"===p.css("box-sizing")||"border-box"===p.css("-moz-box-sizing")||"border-box"===p.css("-webkit-box-sizing"))&&(w=p.outerHeight()-p.height()),c=Math.max(parseInt(p.css("minHeight"),10)-w||0,p.height()),p.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word",resize:"none"===p.css("resize")||"vertical"===p.css("resize")?"none":"horizontal"}),"onpropertychange"in u?"oninput"in u?p.on("input.autosize keyup.autosize",r):p.on("propertychange.autosize",function(){"value"===event.propertyName&&r()}):p.on("input.autosize",r),i.resizeDelay!==!1&&e(window).on("resize.autosize",l),p.on("autosize.resize",r),p.on("autosize.resizeIncludeStyle",function(){t=null,r()}),p.on("autosize.destroy",function(){t=null,clearTimeout(h),e(window).off("resize",l),p.off("autosize").off(".autosize").css(z).removeData("autosize")}),r())})):this}}(window.jQuery||window.$),function($){$.fn.extend({limiter:function(limit,elem){function setCount(src,elem){var chars=src.value.length;chars>limit&&(src.value=src.value.substr(0,limit),chars=limit),elem&&elem.html(limit-chars)}$(this).on("keyup focus",function(){setCount(this,elem)}),setCount($(this)[0],elem)}})}(jQuery),!function(a){"use strict";var b=function(a,c,d){var e,f,g=document.createElement("img");if(g.onerror=c,g.onload=function(){!f||d&&d.noRevoke||b.revokeObjectURL(f),c&&c(b.scale(g,d))},b.isInstanceOf("Blob",a)||b.isInstanceOf("File",a))e=f=b.createObjectURL(a),g._type=a.type;else{if("string"!=typeof a)return!1;e=a,d&&d.crossOrigin&&(g.crossOrigin=d.crossOrigin)}return e?(g.src=e,g):b.readFile(a,function(a){var b=a.target;b&&b.result?g.src=b.result:c&&c(a)})},c=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;b.isInstanceOf=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},b.transformCoordinates=function(){},b.getTransformedOptions=function(a){return a},b.renderImageToCanvas=function(a,b,c,d,e,f,g,h,i,j){return a.getContext("2d").drawImage(b,c,d,e,f,g,h,i,j),a},b.hasCanvasOption=function(a){return a.canvas||a.crop},b.scale=function(a,c){c=c||{};var d,e,f,g,h,i,j,k,l,m=document.createElement("canvas"),n=a.getContext||b.hasCanvasOption(c)&&m.getContext,o=a.naturalWidth||a.width,p=a.naturalHeight||a.height,q=o,r=p,s=function(){var a=Math.max((f||q)/q,(g||r)/r);a>1&&(q=Math.ceil(q*a),r=Math.ceil(r*a))},t=function(){var a=Math.min((d||q)/q,(e||r)/r);1>a&&(q=Math.ceil(q*a),r=Math.ceil(r*a))};return n&&(c=b.getTransformedOptions(c),j=c.left||0,k=c.top||0,c.sourceWidth?(h=c.sourceWidth,void 0!==c.right&&void 0===c.left&&(j=o-h-c.right)):h=o-j-(c.right||0),c.sourceHeight?(i=c.sourceHeight,void 0!==c.bottom&&void 0===c.top&&(k=p-i-c.bottom)):i=p-k-(c.bottom||0),q=h,r=i),d=c.maxWidth,e=c.maxHeight,f=c.minWidth,g=c.minHeight,n&&d&&e&&c.crop?(q=d,r=e,l=h/i-d/e,0>l?(i=e*h/d,void 0===c.top&&void 0===c.bottom&&(k=(p-i)/2)):l>0&&(h=d*i/e,void 0===c.left&&void 0===c.right&&(j=(o-h)/2))):((c.contain||c.cover)&&(f=d=d||f,g=e=e||g),c.cover?(t(),s()):(s(),t())),n?(m.width=q,m.height=r,b.transformCoordinates(m,c),b.renderImageToCanvas(m,a,j,k,h,i,0,0,q,r)):(a.width=q,a.height=r,a)},b.createObjectURL=function(a){return c?c.createObjectURL(a):!1},b.revokeObjectURL=function(a){return c?c.revokeObjectURL(a):!1},b.readFile=function(a,b,c){if(window.FileReader){var d=new FileReader;if(d.onload=d.onerror=b,c=c||"readAsDataURL",d[c])return d[c](a),d}return!1},"function"==typeof define&&define.amd?define(function(){return b}):a.loadImage=b}(this),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image"],a):a(window.loadImage)}(function(a){"use strict";if(window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)){var b=a.renderImageToCanvas;a.detectSubsampling=function(a){var b,c;return a.width*a.height>1048576?(b=document.createElement("canvas"),b.width=b.height=1,c=b.getContext("2d"),c.drawImage(a,-a.width+1,0),0===c.getImageData(0,0,1,1).data[3]):!1},a.detectVerticalSquash=function(a,b){var c,d,e,f,g,h=a.naturalHeight||a.height,i=document.createElement("canvas"),j=i.getContext("2d");for(b&&(h/=2),i.width=1,i.height=h,j.drawImage(a,0,0),c=j.getImageData(0,0,1,h).data,d=0,e=h,f=h;f>d;)g=c[4*(f-1)+3],0===g?e=f:d=f,f=e+d>>1;return f/h||1},a.renderImageToCanvas=function(c,d,e,f,g,h,i,j,k,l){if("image/jpeg"===d._type){var m,n,o,p,q=c.getContext("2d"),r=document.createElement("canvas"),s=1024,t=r.getContext("2d");if(r.width=s,r.height=s,q.save(),m=a.detectSubsampling(d),m&&(e/=2,f/=2,g/=2,h/=2),n=a.detectVerticalSquash(d,m),m||1!==n){for(f*=n,k=Math.ceil(s*k/g),l=Math.ceil(s*l/h/n),j=0,p=0;h>p;){for(i=0,o=0;g>o;)t.clearRect(0,0,s,s),t.drawImage(d,e,f,g,h,-o,-p,g,h),q.drawImage(r,0,0,s,s,i,j,k,l),o+=s,i+=k;p+=s,j+=l}return q.restore(),c}}return b(c,d,e,f,g,h,i,j,k,l)}}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image"],a):a(window.loadImage)}(function(a){"use strict";var b=a.hasCanvasOption;a.hasCanvasOption=function(a){return b(a)||a.orientation},a.transformCoordinates=function(a,b){var c=a.getContext("2d"),d=a.width,e=a.height,f=b.orientation;if(f)switch(f>4&&(a.width=e,a.height=d),f){case 2:c.translate(d,0),c.scale(-1,1);break;case 3:c.translate(d,e),c.rotate(Math.PI);break;case 4:c.translate(0,e),c.scale(1,-1);break;case 5:c.rotate(.5*Math.PI),c.scale(1,-1);break;case 6:c.rotate(.5*Math.PI),c.translate(0,-e);break;case 7:c.rotate(.5*Math.PI),c.translate(d,-e),c.scale(-1,1);break;case 8:c.rotate(-.5*Math.PI),c.translate(-d,0)}},a.getTransformedOptions=function(a){if(!a.orientation||1===a.orientation)return a;var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);switch(a.orientation){case 2:c.left=a.right,c.right=a.left;break;case 3:c.left=a.right,c.top=a.bottom,c.right=a.left,c.bottom=a.top;break;case 4:c.top=a.bottom,c.bottom=a.top;break;case 5:c.left=a.top,c.top=a.left,c.right=a.bottom,c.bottom=a.right;break;case 6:c.left=a.top,c.top=a.right,c.right=a.bottom,c.bottom=a.left;break;case 7:c.left=a.bottom,c.top=a.right,c.right=a.top,c.bottom=a.left;break;case 8:c.left=a.bottom,c.top=a.left,c.right=a.top,c.bottom=a.right}return a.orientation>4&&(c.maxWidth=a.maxHeight,c.maxHeight=a.maxWidth,c.minWidth=a.minHeight,c.minHeight=a.minWidth,c.sourceWidth=a.sourceHeight,c.sourceHeight=a.sourceWidth),c}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image"],a):a(window.loadImage)}(function(a){"use strict";var b=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);a.blobSlice=b&&function(){var a=this.slice||this.webkitSlice||this.mozSlice;return a.apply(this,arguments)},a.metaDataParsers={jpeg:{65505:[]}},a.parseMetaData=function(b,c,d){d=d||{};var e=this,f=d.maxMetaDataSize||262144,g={},h=!(window.DataView&&b&&b.size>=12&&"image/jpeg"===b.type&&a.blobSlice);(h||!a.readFile(a.blobSlice.call(b,0,f),function(b){var f,h,i,j,k=b.target.result,l=new DataView(k),m=2,n=l.byteLength-4,o=m;if(65496===l.getUint16(0)){for(;n>m&&(f=l.getUint16(m),f>=65504&&65519>=f||65534===f);){if(h=l.getUint16(m+2)+2,m+h>l.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(i=a.metaDataParsers.jpeg[f])for(j=0;j<i.length;j+=1)i[j].call(e,l,m,h,g,d);m+=h,o=m}!d.disableImageHead&&o>6&&(g.imageHead=k.slice?k.slice(0,o):new Uint8Array(k).subarray(0,o))}else console.log("Invalid JPEG file: Missing JPEG marker.");c(g)},"readAsArrayBuffer"))&&c(g)}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image","load-image-meta"],a):a(window.loadImage)}(function(a){"use strict";a.ExifMap=function(){return this},a.ExifMap.prototype.map={Orientation:274},a.ExifMap.prototype.get=function(a){return this[a]||this[this.map[a]]},a.getExifThumbnail=function(a,b,c){var d,e,f;if(!c||b+c>a.byteLength)return console.log("Invalid Exif data: Invalid thumbnail data."),void 0;for(d=[],e=0;c>e;e+=1)f=a.getUint8(b+e),d.push((16>f?"0":"")+f.toString(16));return"data:image/jpeg,%"+d.join("%")},a.exifTagTypes={1:{getValue:function(a,b){return a.getUint8(b)},size:1},2:{getValue:function(a,b){return String.fromCharCode(a.getUint8(b))},size:1,ascii:!0},3:{getValue:function(a,b,c){return a.getUint16(b,c)},size:2},4:{getValue:function(a,b,c){return a.getUint32(b,c)},size:4},5:{getValue:function(a,b,c){return a.getUint32(b,c)/a.getUint32(b+4,c)},size:8},9:{getValue:function(a,b,c){return a.getInt32(b,c)},size:4},10:{getValue:function(a,b,c){return a.getInt32(b,c)/a.getInt32(b+4,c)},size:8}},a.exifTagTypes[7]=a.exifTagTypes[1],a.getExifValue=function(b,c,d,e,f,g){var h,i,j,k,l,m,n=a.exifTagTypes[e];if(!n)return console.log("Invalid Exif data: Invalid tag type."),void 0;if(h=n.size*f,i=h>4?c+b.getUint32(d+8,g):d+8,i+h>b.byteLength)return console.log("Invalid Exif data: Invalid data offset."),void 0;if(1===f)return n.getValue(b,i,g);for(j=[],k=0;f>k;k+=1)j[k]=n.getValue(b,i+k*n.size,g);if(n.ascii){for(l="",k=0;k<j.length&&(m=j[k],"\x00"!==m);k+=1)l+=m;return l}return j},a.parseExifTag=function(b,c,d,e,f){var g=b.getUint16(d,e);f.exif[g]=a.getExifValue(b,c,d,b.getUint16(d+2,e),b.getUint32(d+4,e),e)},a.parseExifTags=function(a,b,c,d,e){var f,g,h;if(c+6>a.byteLength)return console.log("Invalid Exif data: Invalid directory offset."),void 0;if(f=a.getUint16(c,d),g=c+2+12*f,g+4>a.byteLength)return console.log("Invalid Exif data: Invalid directory size."),void 0;for(h=0;f>h;h+=1)this.parseExifTag(a,b,c+2+12*h,d,e);return a.getUint32(g,d)},a.parseExifData=function(b,c,d,e,f){if(!f.disableExif){var g,h,i,j=c+10;if(1165519206===b.getUint32(c+4)){if(j+8>b.byteLength)return console.log("Invalid Exif data: Invalid segment size."),void 0;if(0!==b.getUint16(c+8))return console.log("Invalid Exif data: Missing byte alignment offset."),void 0;switch(b.getUint16(j)){case 18761:g=!0;break;case 19789:g=!1;break;default:return console.log("Invalid Exif data: Invalid byte alignment marker."),void 0}if(42!==b.getUint16(j+2,g))return console.log("Invalid Exif data: Missing TIFF marker."),void 0;h=b.getUint32(j+4,g),e.exif=new a.ExifMap,h=a.parseExifTags(b,j,j+h,g,e),h&&!f.disableExifThumbnail&&(i={exif:{}},h=a.parseExifTags(b,j,j+h,g,i),i.exif[513]&&(e.exif.Thumbnail=a.getExifThumbnail(b,j+i.exif[513],i.exif[514]))),e.exif[34665]&&!f.disableExifSub&&a.parseExifTags(b,j,j+e.exif[34665],g,e),e.exif[34853]&&!f.disableExifGps&&a.parseExifTags(b,j,j+e.exif[34853],g,e)}}},a.metaDataParsers.jpeg[65505].push(a.parseExifData)}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image","load-image-exif"],a):a(window.loadImage)}(function(a){"use strict";a.ExifMap.prototype.tags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},a.ExifMap.prototype.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"top-left",2:"top-right",3:"bottom-right",4:"bottom-left",5:"left-top",6:"right-top",7:"right-bottom",8:"left-bottom"}},a.ExifMap.prototype.getText=function(a){var b=this.get(a);switch(a){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[a][b];case"ExifVersion":case"FlashpixVersion":return String.fromCharCode(b[0],b[1],b[2],b[3]);case"ComponentsConfiguration":return this.stringValues[a][b[0]]+this.stringValues[a][b[1]]+this.stringValues[a][b[2]]+this.stringValues[a][b[3]];case"GPSVersionID":return b[0]+"."+b[1]+"."+b[2]+"."+b[3]}return String(b)},function(a){var b,c=a.tags,d=a.map;for(b in c)c.hasOwnProperty(b)&&(d[c[b]]=b)}(a.ExifMap.prototype),a.ExifMap.prototype.getAll=function(){var a,b,c={};for(a in this)this.hasOwnProperty(a)&&(b=this.tags[a],b&&(c[b]=this.getText(b)));return c}}),function(){window.GoogleImageSearch=function(){this.page=1,this.limit=10},GoogleImageSearch.prototype.search=function(query,success,failure,options){var data={searchType:"image",safe:"high",key:"AIzaSyB48slM2dokJ56U588DttNqpJfoyDhCkGk",cx:"011187086756202966114:svrjsuftcw4",q:query,num:this.limit,start:1+(this.page-1)*this.limit};options&&options.site&&(data.siteSearch=options.site),options&&options.rights&&(data.rights=options.rights),console.log(data),$.ajax({url:"https://www.googleapis.com/customsearch/v1",data:data,dataType:"json"}).done(function(data){success(data)}).fail(function(){failure()})}}(),function(){!function(window){function _has(object,key){return Object.prototype.hasOwnProperty.call(object,key)}function _isUndefined(what){return"undefined"==typeof what}var TraceKit={},_oldTraceKit=window.TraceKit,_slice=[].slice,UNKNOWN_FUNCTION="?";TraceKit.noConflict=function(){return window.TraceKit=_oldTraceKit,TraceKit},TraceKit.wrap=function(func){function wrapped(){try{return func.apply(this,arguments)}catch(e){throw TraceKit.report(e),e}}return wrapped},TraceKit.report=function(){function subscribe(handler){installGlobalHandler(),handlers.push(handler)}function unsubscribe(handler){for(var i=handlers.length-1;i>=0;--i)handlers[i]===handler&&handlers.splice(i,1)}function notifyHandlers(stack,windowError){var exception=null;if(!windowError||TraceKit.collectWindowErrors){for(var i in handlers)if(_has(handlers,i))try{handlers[i].apply(null,[stack].concat(_slice.call(arguments,2)))}catch(inner){exception=inner}if(exception)throw exception}}function traceKitWindowOnError(message,url,lineNo){var stack=null;if(lastExceptionStack)TraceKit.computeStackTrace.augmentStackTraceWithInitialElement(lastExceptionStack,url,lineNo,message),stack=lastExceptionStack,lastExceptionStack=null,lastException=null;else{var location={url:url,line:lineNo};location.func=TraceKit.computeStackTrace.guessFunctionName(location.url,location.line),location.context=TraceKit.computeStackTrace.gatherContext(location.url,location.line),stack={mode:"onerror",message:message,url:document.location.href,stack:[location],useragent:navigator.userAgent}}return notifyHandlers(stack,"from window.onerror"),_oldOnerrorHandler?_oldOnerrorHandler.apply(this,arguments):!1}function installGlobalHandler(){_onErrorHandlerInstalled!==!0&&(_oldOnerrorHandler=window.onerror,window.onerror=traceKitWindowOnError,_onErrorHandlerInstalled=!0)}function report(ex){var args=_slice.call(arguments,1);if(lastExceptionStack){if(lastException===ex)return;var s=lastExceptionStack;lastExceptionStack=null,lastException=null,notifyHandlers.apply(null,[s,null].concat(args))}var stack=TraceKit.computeStackTrace(ex);throw lastExceptionStack=stack,lastException=ex,window.setTimeout(function(){lastException===ex&&(lastExceptionStack=null,lastException=null,notifyHandlers.apply(null,[stack,null].concat(args)))},stack.incomplete?2e3:0),ex}var _oldOnerrorHandler,_onErrorHandlerInstalled,handlers=[],lastException=null,lastExceptionStack=null;return report.subscribe=subscribe,report.unsubscribe=unsubscribe,report}(),TraceKit.computeStackTrace=function(){function loadSource(url){function getXHR(){try{return new window.XMLHttpRequest}catch(e){return new window.ActiveXObject("Microsoft.XMLHTTP")}}if(!TraceKit.remoteFetching)return"";try{var request=getXHR();return request.open("GET",url,!1),request.send(""),request.responseText}catch(e){return""}}function getSource(url){if(!_has(sourceCache,url)){var source="";-1!==url.indexOf(document.domain)&&(source=loadSource(url)),sourceCache[url]=source?source.split("\n"):[]}return sourceCache[url]}function guessFunctionName(url,lineNo){var m,reFunctionArgNames=/function ([^(]*)\(([^)]*)\)/,reGuessFunction=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,line="",maxLines=10,source=getSource(url);if(!source.length)return UNKNOWN_FUNCTION;for(var i=0;maxLines>i;++i)if(line=source[lineNo-i]+line,!_isUndefined(line)){if(m=reGuessFunction.exec(line))return m[1];if(m=reFunctionArgNames.exec(line))return m[1]}return UNKNOWN_FUNCTION}function gatherContext(url,line){var source=getSource(url);if(!source.length)return null;var context=[],linesBefore=Math.floor(TraceKit.linesOfContext/2),linesAfter=linesBefore+TraceKit.linesOfContext%2,start=Math.max(0,line-linesBefore-1),end=Math.min(source.length,line+linesAfter-1);line-=1;for(var i=start;end>i;++i)_isUndefined(source[i])||context.push(source[i]);return context.length>0?context:null}function escapeRegExp(text){return text.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function escapeCodeAsRegExpForMatchingInsideHTML(body){return escapeRegExp(body).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function findSourceInUrls(re,urls){for(var source,m,i=0,j=urls.length;j>i;++i)if((source=getSource(urls[i])).length&&(source=source.join("\n"),m=re.exec(source)))return{url:urls[i],line:source.substring(0,m.index).split("\n").length,column:m.index-source.lastIndexOf("\n",m.index)-1};return null}function findSourceInLine(fragment,url,line){var m,source=getSource(url),re=new RegExp("\\b"+escapeRegExp(fragment)+"\\b");return line-=1,source&&source.length>line&&(m=re.exec(source[line]))?m.index:null}function findSourceByFunctionBody(func){for(var body,re,parts,result,urls=[window.location.href],scripts=document.getElementsByTagName("script"),code=""+func,codeRE=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,eventRE=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,i=0;i<scripts.length;++i){var script=scripts[i];script.src&&urls.push(script.src)}if(parts=codeRE.exec(code)){var name=parts[1]?"\\s+"+parts[1]:"",args=parts[2].split(",").join("\\s*,\\s*");body=escapeRegExp(parts[3]).replace(/;$/,";?"),re=new RegExp("function"+name+"\\s*\\(\\s*"+args+"\\s*\\)\\s*{\\s*"+body+"\\s*}")}else re=new RegExp(escapeRegExp(code).replace(/\s+/g,"\\s+"));if(result=findSourceInUrls(re,urls))return result;if(parts=eventRE.exec(code)){var event=parts[1];if(body=escapeCodeAsRegExpForMatchingInsideHTML(parts[2]),re=new RegExp("on"+event+"=[\\'\"]\\s*"+body+"\\s*[\\'\"]","i"),result=findSourceInUrls(re,urls[0]))return result;if(re=new RegExp(body),result=findSourceInUrls(re,urls))return result}return null}function computeStackTraceFromStackProp(ex){if(!ex.stack)return null;for(var parts,element,chrome=/^\s*at (?:((?:\[object object\])?\S+(?: \[as \S+\])?) )?\(?((?:file|http|https):.*?):(\d+)(?::(\d+))?\)?\s*$/i,gecko=/^\s*(\S*)(?:\((.*?)\))?@((?:file|http|https).*?):(\d+)(?::(\d+))?\s*$/i,lines=ex.stack.split("\n"),stack=[],reference=/^(.*) is undefined$/.exec(ex.message),i=0,j=lines.length;j>i;++i){if(parts=gecko.exec(lines[i]))element={url:parts[3],func:parts[1]||UNKNOWN_FUNCTION,args:parts[2]?parts[2].split(","):"",line:+parts[4],column:parts[5]?+parts[5]:null};else{if(!(parts=chrome.exec(lines[i])))continue;element={url:parts[2],func:parts[1]||UNKNOWN_FUNCTION,line:+parts[3],column:parts[4]?+parts[4]:null}}!element.func&&element.line&&(element.func=guessFunctionName(element.url,element.line)),element.line&&(element.context=gatherContext(element.url,element.line)),stack.push(element)}return stack[0]&&stack[0].line&&!stack[0].column&&reference&&(stack[0].column=findSourceInLine(reference[1],stack[0].url,stack[0].line)),stack.length?{mode:"stack",name:ex.name,message:ex.message,url:document.location.href,stack:stack,useragent:navigator.userAgent}:null}function computeStackTraceFromStacktraceProp(ex){for(var parts,stacktrace=ex.stacktrace,testRE=/ line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,lines=stacktrace.split("\n"),stack=[],i=0,j=lines.length;j>i;i+=2)if(parts=testRE.exec(lines[i])){var element={line:+parts[1],column:+parts[2],func:parts[3]||parts[4],args:parts[5]?parts[5].split(","):[],url:parts[6]};
if(!element.func&&element.line&&(element.func=guessFunctionName(element.url,element.line)),element.line)try{element.context=gatherContext(element.url,element.line)}catch(exc){}element.context||(element.context=[lines[i+1]]),stack.push(element)}return stack.length?{mode:"stacktrace",name:ex.name,message:ex.message,url:document.location.href,stack:stack,useragent:navigator.userAgent}:null}function computeStackTraceFromOperaMultiLineMessage(ex){var lines=ex.message.split("\n");if(lines.length<4)return null;var parts,i,len,source,lineRE1=/^\s*Line (\d+) of linked script ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,lineRE2=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,lineRE3=/^\s*Line (\d+) of function script\s*$/i,stack=[],scripts=document.getElementsByTagName("script"),inlineScriptBlocks=[];for(i in scripts)_has(scripts,i)&&!scripts[i].src&&inlineScriptBlocks.push(scripts[i]);for(i=2,len=lines.length;len>i;i+=2){var item=null;if(parts=lineRE1.exec(lines[i]))item={url:parts[2],func:parts[3],line:+parts[1]};else if(parts=lineRE2.exec(lines[i])){item={url:parts[3],func:parts[4]};var relativeLine=+parts[1],script=inlineScriptBlocks[parts[2]-1];if(script&&(source=getSource(item.url))){source=source.join("\n");var pos=source.indexOf(script.innerText);pos>=0&&(item.line=relativeLine+source.substring(0,pos).split("\n").length)}}else if(parts=lineRE3.exec(lines[i])){var url=window.location.href.replace(/#.*$/,""),line=parts[1],re=new RegExp(escapeCodeAsRegExpForMatchingInsideHTML(lines[i+1]));source=findSourceInUrls(re,[url]),item={url:url,line:source?source.line:line,func:""}}if(item){item.func||(item.func=guessFunctionName(item.url,item.line));var context=gatherContext(item.url,item.line),midline=context?context[Math.floor(context.length/2)]:null;item.context=context&&midline.replace(/^\s*/,"")===lines[i+1].replace(/^\s*/,"")?context:[lines[i+1]],stack.push(item)}}return stack.length?{mode:"multiline",name:ex.name,message:lines[0],url:document.location.href,stack:stack,useragent:navigator.userAgent}:null}function augmentStackTraceWithInitialElement(stackInfo,url,lineNo,message){var initial={url:url,line:lineNo};if(initial.url&&initial.line){stackInfo.incomplete=!1,initial.func||(initial.func=guessFunctionName(initial.url,initial.line)),initial.context||(initial.context=gatherContext(initial.url,initial.line));var reference=/ '([^']+)' /.exec(message);if(reference&&(initial.column=findSourceInLine(reference[1],initial.url,initial.line)),stackInfo.stack.length>0&&stackInfo.stack[0].url===initial.url){if(stackInfo.stack[0].line===initial.line)return!1;if(!stackInfo.stack[0].line&&stackInfo.stack[0].func===initial.func)return stackInfo.stack[0].line=initial.line,stackInfo.stack[0].context=initial.context,!1}return stackInfo.stack.unshift(initial),stackInfo.partial=!0,!0}return stackInfo.incomplete=!0,!1}function computeStackTraceByWalkingCallerChain(ex,depth){for(var parts,item,source,functionName=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,stack=[],funcs={},recursion=!1,curr=computeStackTraceByWalkingCallerChain.caller;curr&&!recursion;curr=curr.caller)if(curr!==computeStackTrace&&curr!==TraceKit.report){if(item={url:null,func:UNKNOWN_FUNCTION,line:null,column:null},curr.name?item.func=curr.name:(parts=functionName.exec(curr.toString()))&&(item.func=parts[1]),source=findSourceByFunctionBody(curr)){item.url=source.url,item.line=source.line,item.func===UNKNOWN_FUNCTION&&(item.func=guessFunctionName(item.url,item.line));var reference=/ '([^']+)' /.exec(ex.message||ex.description);reference&&(item.column=findSourceInLine(reference[1],source.url,source.line))}funcs[""+curr]?recursion=!0:funcs[""+curr]=!0,stack.push(item)}depth&&stack.splice(0,depth);var result={mode:"callers",name:ex.name,message:ex.message,url:document.location.href,stack:stack,useragent:navigator.userAgent};return augmentStackTraceWithInitialElement(result,ex.sourceURL||ex.fileName,ex.line||ex.lineNumber,ex.message||ex.description),result}function computeStackTrace(ex,depth){var stack=null;depth=null==depth?0:+depth;try{if(stack=computeStackTraceFromStacktraceProp(ex))return stack}catch(e){if(debug)throw e}try{if(stack=computeStackTraceFromStackProp(ex))return stack}catch(e){if(debug)throw e}try{if(stack=computeStackTraceFromOperaMultiLineMessage(ex))return stack}catch(e){if(debug)throw e}try{if(stack=computeStackTraceByWalkingCallerChain(ex,depth+1))return stack}catch(e){if(debug)throw e}return{mode:"failed"}}function computeStackTraceOfCaller(depth){depth=(null==depth?0:+depth)+1;try{throw new Error}catch(ex){return computeStackTrace(ex,depth+1)}return null}var debug=!1,sourceCache={};return computeStackTrace.augmentStackTraceWithInitialElement=augmentStackTraceWithInitialElement,computeStackTrace.guessFunctionName=guessFunctionName,computeStackTrace.gatherContext=gatherContext,computeStackTrace.ofCaller=computeStackTraceOfCaller,computeStackTrace}(),function(){var _helper=function(fnName){var originalFn=window[fnName];window[fnName]=function(){var args=_slice.call(arguments),originalCallback=args[0];return"function"==typeof originalCallback&&(args[0]=TraceKit.wrap(originalCallback)),originalFn.apply?originalFn.apply(this,args):originalFn(args[0],args[1])}};_helper("setTimeout"),_helper("setInterval")}(),TraceKit.remoteFetching||(TraceKit.remoteFetching=!0),TraceKit.collectWindowErrors||(TraceKit.collectWindowErrors=!0),(!TraceKit.linesOfContext||TraceKit.linesOfContext<1)&&(TraceKit.linesOfContext=11),window.TraceKit=TraceKit}(window);var Notice;Notice=function(){function Notice(options){var k,v,_ref,_ref1,_ref2,_ref3,_ref4;this.options=null!=options?options:{},this.stackInfo=this.options.stackInfo||this.options.error&&TraceKit.computeStackTrace(this.options.error),this.trace=this._parseBacktrace(null!=(_ref=this.stackInfo)?_ref.stack:void 0),this["class"]=null!=(_ref1=this.stackInfo)?_ref1.name:void 0,this.message=null!=(_ref2=this.stackInfo)?_ref2.message:void 0,this.source=this.stackInfo&&this._extractSource(this.stackInfo.stack),this.url=document.URL,this.project_root=Honeybadger.configuration.project_root,this.environment=Honeybadger.configuration.environment,this.component=Honeybadger.configuration.component,this.action=Honeybadger.configuration.action,this.context={},_ref3=Honeybadger.context;for(k in _ref3)v=_ref3[k],this.context[k]=v;if(this.options.context){_ref4=this.options.context;for(k in _ref4)v=_ref4[k],this.context[k]=v}}return Notice.prototype.toJSON=function(){return JSON.stringify({notifier:{name:"honeybadger.js",url:"https://github.com/honeybadger-io/honeybadger-js",version:Honeybadger.version,language:"javascript"},error:{"class":this["class"],message:this.message,backtrace:this.trace,source:this.source},request:{url:this.url,component:this.component,action:this.action,context:this.context,cgi_data:this._cgiData()},server:{project_root:this.project_root,environment_name:this.environment}})},Notice.prototype._parseBacktrace=function(stack){var backtrace,trace,_i,_len,_ref,_ref1;for(null==stack&&(stack=[]),backtrace=[],_i=0,_len=stack.length;_len>_i;_i++)trace=stack[_i],(null!=(_ref=trace.url)?_ref.match(/honeybadger(?:\.min)?\.js/):0)||backtrace.push({file:(null!=(_ref1=trace.url)?_ref1.replace(Honeybadger.configuration.project_root,"[PROJECT_ROOT]"):void 0)||"unknown",number:trace.line,method:trace.func});return backtrace},Notice.prototype._extractSource=function(stack){var i,line,source,_i,_len,_ref,_ref1,_ref2;for(null==stack&&(stack=[]),source={},_ref2=null!=(_ref=null!=(_ref1=stack[0])?_ref1.context:void 0)?_ref:[],i=_i=0,_len=_ref2.length;_len>_i;i=++_i)line=_ref2[i],source[i]=line;return source},Notice.prototype._cgiData=function(){var data,k,v;data={};for(k in navigator)v=navigator[k],"object"!=typeof v&&(data[k.split(/(?=[A-Z][a-z]*)/).join("_").toUpperCase()]=v);return data.HTTP_USER_AGENT=data.USER_AGENT,delete data.USER_AGENT,document.referrer.match(/\S/)&&(data.HTTP_REFERER=document.referrer),data},Notice}();var Honeybadger;Honeybadger=function(){function Honeybadger(){}return Honeybadger.version="0.0.2",Honeybadger.default_configuration={api_key:null,host:"api.honeybadger.io",ssl:!0,project_root:window.location.protocol+"//"+window.location.host,environment:"production",component:null,action:null,disabled:!0,onerror:!1},Honeybadger.configured=!1,Honeybadger.configure=function(options){var k,v;null==options&&(options={}),this.configured===!1&&("undefined"==typeof options.disabled&&(options.disabled=!1),this.configured=!0);for(k in options)v=options[k],this.configuration[k]=v;return TraceKit.collectWindowErrors=this.configuration.onerror,this},Honeybadger.configuration={reset:function(){var k,v,_ref;Honeybadger.configured=!1,_ref=Honeybadger.default_configuration;for(k in _ref)v=_ref[k],Honeybadger.configuration[k]=v;return TraceKit.collectWindowErrors=Honeybadger.configuration.onerror,Honeybadger}},Honeybadger.configuration.reset(),Honeybadger.context={},Honeybadger.resetContext=function(options){return null==options&&(options={}),this.context=options,this},Honeybadger.setContext=function(options){var k,v;null==options&&(options={});for(k in options)v=options[k],this.context[k]=v;return this},Honeybadger.notify=function(error,options){var notice;return null==options&&(options={}),this.configuration.disabled===!0?!1:(error&&(options.error=error),notice=new Notice(options),this._sendRequest(notice.toJSON()))},Honeybadger._sendRequest=function(data){var url;return url="http"+(this.configuration.ssl&&"s"||"")+"://"+this.configuration.host+"/v1/notices.html",this._crossDomainPost(url,data)},Honeybadger._crossDomainPost=function(url,payload){var form,iframe,input,uniqueNameOfFrame;return iframe=document.createElement("iframe"),uniqueNameOfFrame="_hb_"+(new Date).getTime(),document.body.appendChild(iframe),iframe.style.display="none",iframe.contentWindow.name=uniqueNameOfFrame,form=document.createElement("form"),form.target=uniqueNameOfFrame,form.action=url,form.method="POST",input=document.createElement("input"),input.type="hidden",input.name="payload",input.value=payload,form.appendChild(input),input=document.createElement("input"),input.type="hidden",input.name="api_key",input.value=this.configuration.api_key,form.appendChild(input),document.body.appendChild(form),form.submit()},Honeybadger._handleTraceKitSubscription=function(stackInfo){return Honeybadger.notify(null,{stackInfo:stackInfo})},Honeybadger}.call(this),TraceKit.report.subscribe(Honeybadger._handleTraceKitSubscription),("undefined"!=typeof exports&&null!==exports?exports:this).Honeybadger=Honeybadger}.call(this),Honeybadger.configure({api_key:"405ad3e97e985ed8063c17c4537876af",environment:"production"});